{"componentChunkName":"component---src-templates-post-tsx","path":"/2020-12-28-nginx-ingress-controller-selective-auth/index/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABIElEQVQoz52Su0oDQRSGZ8bWVgTBUlGxsbRMYQw2boiNhYKgkEewFKx8DFuLFKbMK9jbiIEU9rnMZSPs+p1ks+7GbeKBj//M7M4/Z86MUkuRpqnyPtY+xMa5YLwX4r+EuQ5HdrZuYn1usJEkSYSewZr6R4zGtlRRHZqYPkJL5ti5BpF1oeZ8uCK/pdIIbaMX6KXkfDvHbH25wns4xmwPnmQuhPiOIw1Z/Iy+MO5CD15Fmeti2CF/e/8YGFkznrjc8AYeoLGokN5twglswSHsww6cYta2zh9Q0TYbHpXMJDDRmF2juzL+7H+t1L+SWVahLpibrIcqu0VdZDr91vNXEAz90xx59j/z0qbfZyKmC+NsXHmLosW8MqgqN6gyWzV+AM1IPLU6r0ZQAAAAAElFTkSuQmCC","width":400,"height":174,"src":"/static/901980ec635ef9ce37ac8ad1c445a1bc/497c6/woojin-logo.png","srcSet":"/static/901980ec635ef9ce37ac8ad1c445a1bc/497c6/woojin-logo.png 1x"}}},"markdownRemark":{"html":"<h1>개요</h1>\n<p><a href=\"/2020-12-19-nginx-ingress-controller-auth/index/\">지난 포스팅</a> 에서 kubernetes 에서\nnginx ingress controller 를 활용하여 auth 를 진행하는 법을 살펴보았다.</p>\n<p>실제 서비스를 개발하다보면, 모든 경로에 대해서 인증을 진행해야 하는 것이 아니라 일부 경로는 인증을 해야 하고, 일부 경로는 인증을 하지 않아야 하는 경우가 생긴다.</p>\n<p>본 포스팅에서는 nginx ingress controller 에서 선택적으로 인증을 하는 방법에 대해 살펴본다.</p>\n<h1>구현하기</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># auth-ingress.yaml</span>\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># Some metadata</span>\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//auth.default.svc.cluster.local/auth/authz\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-method</span><span class=\"token punctuation\">:</span> POST\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-response-headers</span><span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">-</span>auth<span class=\"token punctuation\">-</span>role<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">-</span>auth<span class=\"token punctuation\">-</span>id\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /main\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> main\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token comment\"># other services specs</span></code></pre></div>\n<p>위의 ingress 에 정의된 spec 의 경로들은 모두 해당하는 서비스에 요청하기 전에 <code class=\"language-text\">http://auth.default.svc.cluster.local/auth/authz</code>\n에 요청을 보내 인증을 진행하고, 인증이 올바르게 된 경우에는 타겟 서비스에 요청이 전달되게 된다.\n자세한 내용은 <a href=\"/2020-12-19-nginx-ingress-controller-auth/index/\">지난 포스팅</a>을 참고하자.</p>\n<p>이 때, <code class=\"language-text\">main</code> 이라는 서비스가 존재하고 이 중, 다른 경로에 대해서는 인증을 진행해야 하지만,\n<code class=\"language-text\">/main/products</code> 경로에 대해 인증을 하지 않아야 하는 경우를 가정해보자.</p>\n<p><code class=\"language-text\">auth-snippet</code> 이라는 어노테이션을 통해 위의 문제를 해결할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># auth-ingress.yaml</span>\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># Some metadata</span>\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-url</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//auth.default.svc.cluster.local/auth/authz\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-method</span><span class=\"token punctuation\">:</span> POST\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-response-headers</span><span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">-</span>auth<span class=\"token punctuation\">-</span>role<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">-</span>auth<span class=\"token punctuation\">-</span>id\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/auth-snippet</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n      if ( $request_uri ~ \"/main/products\" ) {\n        return 200;\n      }</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /main\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> main\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n    <span class=\"token comment\"># other services specs</span></code></pre></div>\n<p><code class=\"language-text\">nginx.ingress.kubernetes.io/auth-snippet</code> 가 선언된 부분을 보자.</p>\n<p>요청 URI 가 “/main/products’ 이면 바로 200 코드를 리턴하고 있다. 이로써, <code class=\"language-text\">/main/products</code> 경로로 요청이 들어오면,\n<code class=\"language-text\">http://auth.default.svc.cluster.local/auth/authz</code> 로 인증을 요청하는 것이 아니라 바로 200 상태코드를 리턴하게 되고,\n인증이 성공된 것으로 간주되어 타겟 서비스로 요청이 전달되게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if ( $request_uri ~ &quot;/main/products&quot; ) {\n  return 200;\n}</code></pre></div>\n<p>이 부분은 nginx 문법을 사용하는 것이니 특정 path 로 시작하는 것, 끝나는 것, 그 외 nginx 설정에서 지원하는 방법을 지원하니,\n다양한 방법으로 다양한 경로에 대한 설정을 할 수 있을 것이다.\n(<a href=\"https://www.programmersought.com/article/99462844690/\">이 아티클</a>에도 잘 나와있다.)</p>\n<p>다만, 추후 유지보수를 위해 주석을 필히 같이 남겨주는 것이 좋을 것 같다.</p>\n<h1>마무리</h1>\n<p><a href=\"/2020-12-17-nginx-ingress-controller/index/\">nginx ingress controller 에 대한 사용법</a>\n그리고 <a href=\"/2020-12-19-nginx-ingress-controller-auth/index/\">nginx ingress controller 를 통해 auth 서비스를 설정하는 법</a>,\n오늘은 선택적으로 인증을 진행하는 법에 대해 다루었다.</p>\n<p>이 정도면, 일반적인 케이스의 서비스를 개발하는데는 무리가 없을 것이라 생각된다.</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"개요"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"/2020-12-19-nginx-ingress-controller-auth/index/"},"children":[{"type":"text","value":"지난 포스팅"}]},{"type":"text","value":" 에서 kubernetes 에서\nnginx ingress controller 를 활용하여 auth 를 진행하는 법을 살펴보았다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실제 서비스를 개발하다보면, 모든 경로에 대해서 인증을 진행해야 하는 것이 아니라 일부 경로는 인증을 해야 하고, 일부 경로는 인증을 하지 않아야 하는 경우가 생긴다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"본 포스팅에서는 nginx ingress controller 에서 선택적으로 인증을 하는 방법에 대해 살펴본다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"구현하기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# auth-ingress.yaml"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" networking.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Some metadata"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"annotations"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-url"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" http"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//auth.default.svc.cluster.local/auth/authz\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-method"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" POST\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-response-headers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"auth"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"role"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"auth"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"id\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"http"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"paths"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /main\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pathType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" prefix\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"backend"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" main\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"servicePort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# other services specs"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위의 ingress 에 정의된 spec 의 경로들은 모두 해당하는 서비스에 요청하기 전에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://auth.default.svc.cluster.local/auth/authz"}]},{"type":"text","value":"\n에 요청을 보내 인증을 진행하고, 인증이 올바르게 된 경우에는 타겟 서비스에 요청이 전달되게 된다.\n자세한 내용은 "},{"type":"element","tagName":"a","properties":{"href":"/2020-12-19-nginx-ingress-controller-auth/index/"},"children":[{"type":"text","value":"지난 포스팅"}]},{"type":"text","value":"을 참고하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이 때, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":" 이라는 서비스가 존재하고 이 중, 다른 경로에 대해서는 인증을 진행해야 하지만,\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/main/products"}]},{"type":"text","value":" 경로에 대해 인증을 하지 않아야 하는 경우를 가정해보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"auth-snippet"}]},{"type":"text","value":" 이라는 어노테이션을 통해 위의 문제를 해결할 수 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# auth-ingress.yaml"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" networking.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Some metadata"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"annotations"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-url"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" http"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//auth.default.svc.cluster.local/auth/authz\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-method"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" POST\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-response-headers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"auth"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"role"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"x"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"auth"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"id\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-snippet"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","scalar","string"]},"children":[{"type":"text","value":"\n      if ( $request_uri ~ \"/main/products\" ) {\n        return 200;\n      }"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"http"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"paths"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /main\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pathType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" prefix\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"backend"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" main\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"servicePort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# other services specs"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"nginx.ingress.kubernetes.io/auth-snippet"}]},{"type":"text","value":" 가 선언된 부분을 보자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"요청 URI 가 “/main/products’ 이면 바로 200 코드를 리턴하고 있다. 이로써, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/main/products"}]},{"type":"text","value":" 경로로 요청이 들어오면,\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://auth.default.svc.cluster.local/auth/authz"}]},{"type":"text","value":" 로 인증을 요청하는 것이 아니라 바로 200 상태코드를 리턴하게 되고,\n인증이 성공된 것으로 간주되어 타겟 서비스로 요청이 전달되게 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"if ( $request_uri ~ \"/main/products\" ) {\n  return 200;\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이 부분은 nginx 문법을 사용하는 것이니 특정 path 로 시작하는 것, 끝나는 것, 그 외 nginx 설정에서 지원하는 방법을 지원하니,\n다양한 방법으로 다양한 경로에 대한 설정을 할 수 있을 것이다.\n("},{"type":"element","tagName":"a","properties":{"href":"https://www.programmersought.com/article/99462844690/"},"children":[{"type":"text","value":"이 아티클"}]},{"type":"text","value":"에도 잘 나와있다.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다만, 추후 유지보수를 위해 주석을 필히 같이 남겨주는 것이 좋을 것 같다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"마무리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"/2020-12-17-nginx-ingress-controller/index/"},"children":[{"type":"text","value":"nginx ingress controller 에 대한 사용법"}]},{"type":"text","value":"\n그리고 "},{"type":"element","tagName":"a","properties":{"href":"/2020-12-19-nginx-ingress-controller-auth/index/"},"children":[{"type":"text","value":"nginx ingress controller 를 통해 auth 서비스를 설정하는 법"}]},{"type":"text","value":",\n오늘은 선택적으로 인증을 진행하는 법에 대해 다루었다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이 정도면, 일반적인 케이스의 서비스를 개발하는데는 무리가 없을 것이라 생각된다."}]}],"data":{"quirksMode":false}},"excerpt":"개요 지난 포스팅 에서 kubernetes 에서\nnginx ingress controller 를 활용하여 auth…","timeToRead":2,"frontmatter":{"title":"Kubernetes Nginx Ingress Controller 선택적으로 Auth(인증) 하기","userDate":"28 December 2020","date":"2020-12-28T00:00:00.000Z","tags":["kubernetes","nginx","nginx ingress controller","auth","microservice"],"excerpt":null,"image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADX0lEQVQ4y51Va0hUQRQeyaCC+hUV1J8KiR5kVqaVED3ohRaZRRoS+UP6U2aFGj4CiaRCzXxlWRlpL3uY5WNdK1s19+7eq+aLyJYiKKw2UsxK9/E1c9a9ezX908Bh5n5n5ptzzpxzLoNmOJ1OEvfa5rBj9BCYdo977R5sLDK7wwG706HiZ5UbSFOK4BjGhM4+fNloUqYFxAGbw6YqK943wPfOfrDMJSRLb0fgyXvDCGsdmouFMI9VHvc6rBbsqowDu7gcLMsP3vlBJGLNLvphZ8UJtFm71f1aa5nbMjG+/+5FbH0mvHIDwc7NA8teiYmCSHxz8c5fy+cArpsPr7zVOFqfAeuvH9ByMHeshCszrm0Fy1iEyQXrEK5LxIKSvWTVBE4kCFiOP2Zd307W00V87/SrW1BmqVNjy9wvGVmTQhuEmzGGdML6hwYQeD8K7MJSuoRlLMaF1tukC356jDwQZ/ZWnVRjqhIeepFG8RGHU02Fanx6BqyYXRTMD/tznS8KO8sI31+TzK1fRmeialPVWKqE0c/PuDZwwhRjAWGW3o80K1+6MIUsXKQS7uMhof08JAf1qf9aqCVMasonLK4xCxktt2hd+u4Z2HkfXO54pCEUHi1GRG3ScAzHIUwcJkx4lUP5J/W00/eJhiweQ9cFEbokrluISdkbkFRdAOuXfgzaxiXMIyxFukRWzSkKwaefXwn70PeJ5jBdAmZm70BJpR4lNXro62QYjO2jHiXLb0QMiZB/i5dffjcSQ3ZPFYXrkpH2oBghRfEIrU4grOaleVTaiBITacMTVoyY+nRKFUoZrgutilcJt5XHIvNRKbwyg7BH78JbuyyexC7trsXUy+vpJadd2YhQnrxiZjmrKKkn5K0hD1beO4CQiuMIKDyEUt0zbL8Wh9O1N9DzuQ8NpvaRpff55zdEC9dFzvHyYoKIys1VelQd2SvA0uYi98lDvGnpxGtzGxRjC+rqG2GUTGM3B1NPBzY/Pswt8qUQqM2BmoUvNpUdQbnBgGZZhmSWYJbNaFYUKIo8VvvyEN/t1sOnOExtX/Nv7sadtzrXpXInJJMEWVa4yKqwsZqkXdPnBu2DOCUVINl4Cb9tfwgbsjthaGqGJDXBxEndYubC/ucX4OA6pc0Co9IFU8ubEfIXW5fZ0I9ywakAAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/77ff7d950e67d35e8538892f657bf864/d2c76/nginx-auth.png","srcSet":"/static/77ff7d950e67d35e8538892f657bf864/d2c76/nginx-auth.png 429w","sizes":"(max-width: 429px) 100vw, 429px"}}},"author":[{"id":"Woojin","bio":"This is another test author with a profile background image","avatar":{"children":[{"__typename":"ImageSharp","fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAdV5qKgwXH//xAAZEAEBAAMBAAAAAAAAAAAAAAABAgADEgT/2gAIAQEAAQUC27SoISuJy/OsRz0g5//EABcRAQADAAAAAAAAAAAAAAAAAAABAhH/2gAIAQMBAT8BxNH/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/AYxb/8QAGxAAAgMAAwAAAAAAAAAAAAAAAREAAiEQMUH/2gAIAQEABj8CC9iBeaOFWCgZsMc6n//EABsQAQADAQADAAAAAAAAAAAAAAEAESExQVGB/9oACAEBAAE/IXs9PYxNZPCyYB6zWAFPviCw7C9VE7Y//9oADAMBAAIAAwAAABAY7//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxDeJIt//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARUf/aAAgBAgEBPxBAMbfb/8QAGxABAQACAwEAAAAAAAAAAAAAAREAMSFBUYH/2gAIAQEAAT8Qb0BngyYMN1g0Xzu5DRTRVwq5Wq4D5nJCmiAqB5rJ3rJYZ//Z","aspectRatio":1.3333333333333333,"src":"/static/e51acbf8a0e98b7912a2f1b775f15047/2f1b1/woojin.jpg","srcSet":"/static/e51acbf8a0e98b7912a2f1b775f15047/b3d27/woojin.jpg 40w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/5a735/woojin.jpg 80w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/6e81a/woojin.jpg 120w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/2f1b1/woojin.jpg 800w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/c4b07/woojin.jpg 1440w","sizes":"(max-width: 800px) 100vw, 800px"}}]}}]}},"relatedPosts":{"totalCount":3,"edges":[{"node":{"id":"06b9fee7-eb77-53a8-aab1-2bc65fce5973","timeToRead":2,"excerpt":"개요 지난 포스팅 에서 kubernetes 에서\nnginx ingress controller 를 활용하여 auth…","frontmatter":{"title":"Kubernetes Nginx Ingress Controller 선택적으로 Auth(인증) 하기","date":"2020-12-28T00:00:00.000Z"},"fields":{"slug":"/2020-12-28-nginx-ingress-controller-selective-auth/index/"}}},{"node":{"id":"cb50cfd3-f7bf-5f2a-85fb-c241ae9f2900","timeToRead":4,"excerpt":"nginx ingress controller…","frontmatter":{"title":"Kubernetes Nginx Ingress Controller Auth(인증) 사용하기","date":"2020-12-19T00:00:00.000Z"},"fields":{"slug":"/2020-12-19-nginx-ingress-controller-auth/index/"}}},{"node":{"id":"33ca5fd2-bafd-5faa-962f-1e184d7c7983","timeToRead":2,"excerpt":"개요 쿠버네티스 클러스터 외부의 트래픽을 정해진 라우팅 규칙을 통해 내부 서비스로 연결해주는 \n쿠버네티스 리소스를 인그레스(ingress) 라고 한다. 인그레스가 작동하려면 인그레스 컨트롤러가 반드시 필요한데 본 포스팅에서는 Nginx Ingress…","frontmatter":{"title":"Minikube 로 Nginx Ingress Controller 사용하기 (with AWS ECR)","date":"2020-12-17T00:00:00.000Z"},"fields":{"slug":"/2020-12-17-nginx-ingress-controller/index/"}}}]}},"pageContext":{"slug":"/2020-12-28-nginx-ingress-controller-selective-auth/index/","prev":{"excerpt":"nginx ingress controller…","timeToRead":4,"frontmatter":{"title":"Kubernetes Nginx Ingress Controller Auth(인증) 사용하기","tags":["kubernetes","nginx","nginx ingress controller","auth","microservice"],"date":"2020-12-19T00:00:00.000Z","draft":false,"excerpt":null,"image":{"childImageSharp":{"fluid":{"aspectRatio":1,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAADX0lEQVQ4y51Va0hUQRQeyaCC+hUV1J8KiR5kVqaVED3ohRaZRRoS+UP6U2aFGj4CiaRCzXxlWRlpL3uY5WNdK1s19+7eq+aLyJYiKKw2UsxK9/E1c9a9ezX908Bh5n5n5ptzzpxzLoNmOJ1OEvfa5rBj9BCYdo977R5sLDK7wwG706HiZ5UbSFOK4BjGhM4+fNloUqYFxAGbw6YqK943wPfOfrDMJSRLb0fgyXvDCGsdmouFMI9VHvc6rBbsqowDu7gcLMsP3vlBJGLNLvphZ8UJtFm71f1aa5nbMjG+/+5FbH0mvHIDwc7NA8teiYmCSHxz8c5fy+cArpsPr7zVOFqfAeuvH9ByMHeshCszrm0Fy1iEyQXrEK5LxIKSvWTVBE4kCFiOP2Zd307W00V87/SrW1BmqVNjy9wvGVmTQhuEmzGGdML6hwYQeD8K7MJSuoRlLMaF1tukC356jDwQZ/ZWnVRjqhIeepFG8RGHU02Fanx6BqyYXRTMD/tznS8KO8sI31+TzK1fRmeialPVWKqE0c/PuDZwwhRjAWGW3o80K1+6MIUsXKQS7uMhof08JAf1qf9aqCVMasonLK4xCxktt2hd+u4Z2HkfXO54pCEUHi1GRG3ScAzHIUwcJkx4lUP5J/W00/eJhiweQ9cFEbokrluISdkbkFRdAOuXfgzaxiXMIyxFukRWzSkKwaefXwn70PeJ5jBdAmZm70BJpR4lNXro62QYjO2jHiXLb0QMiZB/i5dffjcSQ3ZPFYXrkpH2oBghRfEIrU4grOaleVTaiBITacMTVoyY+nRKFUoZrgutilcJt5XHIvNRKbwyg7BH78JbuyyexC7trsXUy+vpJadd2YhQnrxiZjmrKKkn5K0hD1beO4CQiuMIKDyEUt0zbL8Wh9O1N9DzuQ8NpvaRpff55zdEC9dFzvHyYoKIys1VelQd2SvA0uYi98lDvGnpxGtzGxRjC+rqG2GUTGM3B1NPBzY/Pswt8qUQqM2BmoUvNpUdQbnBgGZZhmSWYJbNaFYUKIo8VvvyEN/t1sOnOExtX/Nv7sadtzrXpXInJJMEWVa4yKqwsZqkXdPnBu2DOCUVINl4Cb9tfwgbsjthaGqGJDXBxEndYubC/ucX4OA6pc0Co9IFU8ubEfIXW5fZ0I9ywakAAAAASUVORK5CYII=","sizes":"(max-width: 429px) 100vw, 429px","src":"/static/77ff7d950e67d35e8538892f657bf864/d2c76/nginx-auth.png","srcSet":"/static/77ff7d950e67d35e8538892f657bf864/d2c76/nginx-auth.png 429w"}}},"author":[{"id":"Woojin","bio":"This is another test author with a profile background image","avatar":{"children":[{"fluid":{"aspectRatio":1.3333333333333333,"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAdV5qKgwXH//xAAZEAEBAAMBAAAAAAAAAAAAAAABAgADEgT/2gAIAQEAAQUC27SoISuJy/OsRz0g5//EABcRAQADAAAAAAAAAAAAAAAAAAABAhH/2gAIAQMBAT8BxNH/xAAXEQEAAwAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/AYxb/8QAGxAAAgMAAwAAAAAAAAAAAAAAAREAAiEQMUH/2gAIAQEABj8CC9iBeaOFWCgZsMc6n//EABsQAQADAQADAAAAAAAAAAAAAAEAESExQVGB/9oACAEBAAE/IXs9PYxNZPCyYB6zWAFPviCw7C9VE7Y//9oADAMBAAIAAwAAABAY7//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxDeJIt//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARUf/aAAgBAgEBPxBAMbfb/8QAGxABAQACAwEAAAAAAAAAAAAAAREAMSFBUYH/2gAIAQEAAT8Qb0BngyYMN1g0Xzu5DRTRVwq5Wq4D5nJCmiAqB5rJ3rJYZ//Z","sizes":"(max-width: 800px) 100vw, 800px","src":"/static/e51acbf8a0e98b7912a2f1b775f15047/2f1b1/woojin.jpg","srcSet":"/static/e51acbf8a0e98b7912a2f1b775f15047/fd013/woojin.jpg 200w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/25252/woojin.jpg 400w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/2f1b1/woojin.jpg 800w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/0ff54/woojin.jpg 1200w,\n/static/e51acbf8a0e98b7912a2f1b775f15047/c4b07/woojin.jpg 1440w"}}]}}]},"fields":{"layout":"","slug":"/2020-12-19-nginx-ingress-controller-auth/index/"}},"next":null,"primaryTag":"kubernetes"}},"staticQueryHashes":["1065875448","4129920265"]}