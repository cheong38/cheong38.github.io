<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[우진의 음주코딩]]></title><description><![CDATA[TIL(Today I Learned), 소프트웨어, 프로그래밍 등을 기록합니다.]]></description><link>https://cheong38.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 08 Feb 2021 05:16:35 GMT</lastBuildDate><item><title><![CDATA[AWS EC2 User Data 핸즈온]]></title><description><![CDATA[EC2 User Data EC2 User Data 스크립트를 이용해 인스턴스를 bootstrap 하는 것이 가능하다. bootstrap 이란 머신이 시작할 때의 시작 커맨드들을 의미한다. 이 스크립트는 인스턴스의 첫 시작 때 딱 한 번 실행된다. EC…]]></description><link>https://cheong38.github.io/2021-02-08-ec2-user-data/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-08-ec2-user-data/index/</guid><pubDate>Mon, 08 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;EC2 User Data&lt;/h1&gt;
&lt;p&gt;EC2 User Data 스크립트를 이용해 인스턴스를 &lt;strong&gt;bootstrap&lt;/strong&gt; 하는 것이 가능하다.&lt;/p&gt;
&lt;p&gt;bootstrap 이란 머신이 시작할 때의 시작 커맨드들을 의미한다.&lt;/p&gt;
&lt;p&gt;이 스크립트는 인스턴스의 첫 시작 때 &lt;strong&gt;딱 한 번&lt;/strong&gt; 실행된다.&lt;/p&gt;
&lt;p&gt;EC2 User Data 는 다음과 같은 작업들을 자동화할 때 사용된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;소프트웨어 설치하기&lt;/li&gt;
&lt;li&gt;인터넷에서 공통 파일들 다운로드하기&lt;/li&gt;
&lt;li&gt;그 외 인스턴스를 실행할 때 필요한 그 어떤 것&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;EC2 User Data 는 &lt;strong&gt;root&lt;/strong&gt; 권한으로 실행된다.&lt;/p&gt;
&lt;h2&gt;핸즈온&lt;/h2&gt;
&lt;p&gt;이번 핸즈온에서는 nginx 로 User Data 로 다음과 같은 작업을 수행한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;nginx 를 설치&lt;/li&gt;
&lt;li&gt;nginx 기본 페이지를 간단한 Hello World 페이지로 대체&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;---- 실제 AWS 콘솔에서의 실행화면 캡처해서 순차적으로 핸즈온 넣을 것&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Public IP vs Private IP]]></title><description><![CDATA[Public IP vs Private IP Public IP 인터넷 상에서 컴퓨터를 식별할 수 있는 주소로 사용 전체 인터넷 상에서 유일해야 함 (두 개 이상의 컴퓨터가 같은 IP…]]></description><link>https://cheong38.github.io/2021-02-06-public-private-ip/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-06-public-private-ip/index/</guid><pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Public IP vs Private IP&lt;/h1&gt;
&lt;h2&gt;Public IP&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;인터넷 상에서 컴퓨터를 식별할 수 있는 주소로 사용&lt;/li&gt;
&lt;li&gt;전체 인터넷 상에서 유일해야 함 (두 개 이상의 컴퓨터가 같은 IP 를 사용할 수 없음)&lt;/li&gt;
&lt;li&gt;지리적으로 쉽게 위치를 찾을 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Private IP&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Private network 상에서만 컴퓨터를 식별할 수 있는 주소&lt;/li&gt;
&lt;li&gt;같은 Private network 내에서는 유일해야 함&lt;/li&gt;
&lt;li&gt;그러나 서로 다른 두 개의 Private network 에서는 서로 같은 Private IP 주소를 가질 수 있음&lt;/li&gt;
&lt;li&gt;컴퓨터들은 Internet Gateway 나 NAT 등을 통해 인터넷에 접근&lt;/li&gt;
&lt;li&gt;Private IP 를 위한 특정 IP 주소 대역이 있음&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Public IP vs Private IP 예제&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1011px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/24216da8aa4de74c686e9998b9cdcfcc/0d97d/public-private-ip-example.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.8%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAACbUlEQVQ4y31UiW7TQBTM/38MEhKiFIFUKQJCgYZWSQ/naBynjl3f8X0Ob5+zkeOSPGm9a+++2Xmzsx6Aoq5rVFUthliqBt59uMJKM/m9oZbnOQzThGW9YrZY4/3FEPfKGm1ug24MxMO2bUyn91gs5pgtN/j05RtUCUjri6KApmnQ1ioDXn79jsfZGcCqqhCGIUpKFMwuPl9B3ZiQ7Luhmw4+Xl7haX4CsGmOP4Rxyiz8INozbBhU9FVVIthFtKlxNP+Gofgom4yqLLlUGU1Ts5bd6IMdALuTLaN2LKTwiZFCjFVt25a4n++uP8uwy9Txdrj+fYubmxv8Gd+RHBlOrZc5g//RlqGSVj9G1/h7e4fRz1942Vo4FwLrwDBJEm5CpzRNWb+yrOD6IeIkRxil/F2sLUlf3/epedx7nnfQ+wDoOA6WyyWXN58vyJsO8ix7w6AockRRjM2Lzt6dTCYwyfRiEwbMKEmwEtYQve8H5DEVz+stJZc9zfZeNCy6ABo8P9ofXs2AIn8grfCytbELqeSiQkkLEiqvf4pynFN5WV4wCU23WA7xzgyjOOGBpr9iqmzgBTG/C0261uiepGDTAjZYrHQ8LrasMwM+KCtsX11aUMJ2d1SOg4IOI05S/jUIjD5gTmD3lGe7IefppgvLCYh5iYHt+FCeDUTksSzL8UCXfq3TBqSt1K1vYnEFTcujPJP1C4IdJk8aDCvAoHu9Wn0qpi9Osw8k+1aO459GkhZIs6I9FNFc14Ou64jjCDVdOblRt1TZS0dk1CzLgmEYSMnDgvnhLiuKguFwyJN9oFM/BAE8Ho8xGo3Y3CL+AY1Lcd5cdvKbAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Public, Private IP Example&quot;
        title=&quot;Public, Private IP Example&quot;
        src=&quot;/static/24216da8aa4de74c686e9998b9cdcfcc/0d97d/public-private-ip-example.png&quot;
        srcset=&quot;/static/24216da8aa4de74c686e9998b9cdcfcc/0eb09/public-private-ip-example.png 500w,
/static/24216da8aa4de74c686e9998b9cdcfcc/1263b/public-private-ip-example.png 1000w,
/static/24216da8aa4de74c686e9998b9cdcfcc/0d97d/public-private-ip-example.png 1011w&quot;
        sizes=&quot;(max-width: 1011px) 100vw, 1011px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;상단의 Public IP 를 바로 갖는 두 대의 서버는 인터넷에 직접 연결된다.
이와 반대로 Company A, B 의 Private network 내의 컴퓨터는 각각 Private IP 를 할당 받고,
이는 각 회사의 Private netowrk 상에서만 유효하다.
그리고 Company A 의 Private IP 와 Company B 의 Private IP 는 같은 IP 가 될 수도 있다.
Company A 와 Company B 의 Private network 는 각각의 Internet gateway 를 통해
인터넷에 연결된다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AWS Security Group]]></title><description><![CDATA[Security Group AWS 에서 Security Group 은 EC2 인스턴스에 대한 방화벽으로 동작한다. Security Group 은 다음과 같은 것들을 제어한다. 포트에 대한 접근 IP 번위에 대한 인가 inbound…]]></description><link>https://cheong38.github.io/2021-02-06-aws-security-group/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-06-aws-security-group/index/</guid><pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Security Group&lt;/h1&gt;
&lt;p&gt;AWS 에서 Security Group 은 EC2 인스턴스에 대한 &lt;strong&gt;방화벽&lt;/strong&gt;으로 동작한다.&lt;/p&gt;
&lt;p&gt;Security Group 은 다음과 같은 것들을 제어한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;포트에 대한 접근&lt;/li&gt;
&lt;li&gt;IP 번위에 대한 인가&lt;/li&gt;
&lt;li&gt;inbound(다른 컴퓨터로부터 들어오는) 네트워크에 대한 제어&lt;/li&gt;
&lt;li&gt;outbound(다른 컴퓨터로 나가는) 네트워크에 대한 제어&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Security Group 의 예시는 아래와 같다.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1929px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e6da3af12608014c6ced7f5dfa2d4099/07e0b/security_group_example.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 13.600000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAdElEQVQI101OWw7DMAjL/Q/bbmkCeRC5uDTTPiwwNoZ0nh+MMdB7h4iitYbunFVEnjlBrqo/zr6UCvX5eP2HZyUzw5wTrFcpj5k9DVyYFpp4wDdnbH9zX61xkHxnJF5aa8Ec/IgCeXwY2uY5X+H1ReK/37gBNLTq1MQgI3MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Security Group Example&quot;
        title=&quot;Security Group Example&quot;
        src=&quot;/static/e6da3af12608014c6ced7f5dfa2d4099/07e0b/security_group_example.png&quot;
        srcset=&quot;/static/e6da3af12608014c6ced7f5dfa2d4099/0eb09/security_group_example.png 500w,
/static/e6da3af12608014c6ced7f5dfa2d4099/1263b/security_group_example.png 1000w,
/static/e6da3af12608014c6ced7f5dfa2d4099/07e0b/security_group_example.png 1929w&quot;
        sizes=&quot;(max-width: 1929px) 100vw, 1929px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Security Group 에 대한 다이어그램을 나타내면 아래와 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 711px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7e4df80e35e2b6619e1c20db7faa1df9/5e9f9/security_group_diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.8%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABwklEQVQoz3WSa2/aMBSG8/9/yz7s0zSJSmsrWm2oTJR7IMmAFMiFAHYSQm48swNF+zJLj15bPj4+N4N/1uVy4aK1yog2Q3brPuGNgzekLmNlc7X73zLEqUIjFXe7+oRrdbBGL40uzF/8mb5AJe4P67qmqqpG9Qefe2O6KZg05GyPIeIsiJMNJFOQU8poAGIC6ZQomOOuNxzEHsdxGI1GjWoWiwVBEGDYIVgKO7wQxYJzdSZNPLbmE6vhD94ev+D0HvDNZ9KDS5blnM8ZYRiyXq9xXbdBSokQAuN18EH73aXdW3LO62s6uUCsOmRen2TRQdg/EVZb1dIk2GyJw4BAOTRNk263y3g8bqLzfR/j23Ofr603nroOeXkrUJWoFC2FDZkDJ6XJHIrD9boommiSJKFQe606wizLMMxtyWSdM/NKokSSFglxvFHR/ca3XrHfHxrVZxEuCPcRMj02TdBOLMtqVJ/3+z3GzKuUsxrtOIolp/JELFVthg98jB+Zd79j91qsBi2OgcNBqqalAikky+WS2WzGarXieDyy2+1UU/wCyyvQmhe3uVFzSKxSTJ0ric1FzqCU93kty7KJ6nNkNDr9v5FppYN5/Td0AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Security Group Diagram&quot;
        title=&quot;Security Group Diagram&quot;
        src=&quot;/static/7e4df80e35e2b6619e1c20db7faa1df9/5e9f9/security_group_diagram.png&quot;
        srcset=&quot;/static/7e4df80e35e2b6619e1c20db7faa1df9/0eb09/security_group_diagram.png 500w,
/static/7e4df80e35e2b6619e1c20db7faa1df9/5e9f9/security_group_diagram.png 711w&quot;
        sizes=&quot;(max-width: 711px) 100vw, 711px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;inbound 규칙으로 22번 포트에 대해서는 내 컴퓨터 IP 로부터의 요청만 인가하고, 다른 IP 는 거부한다.
outbound 는 모든 IP 와 Port 로의 요청을 인가한다. &lt;/p&gt;
&lt;h2&gt;알아두면 좋을 것들&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Security Group 은 복수의 인스턴스에 attach 될 수 있다.&lt;/li&gt;
&lt;li&gt;region 내 VPC 에 속해있게 된다.&lt;/li&gt;
&lt;li&gt;EC2 인스턴스 밖에 있어서 EC2 인스턴스에서는 Security Group 의 존재를 알지 못한다.&lt;/li&gt;
&lt;li&gt;SSH 접근을 위한 Security Group 을 유지하는 것이 좋다.&lt;/li&gt;
&lt;li&gt;어플리케이션 접근 시 timeout 이 난다면, Security Group 이슈를 살펴보는 것이 좋다.&lt;/li&gt;
&lt;li&gt;어플리케이션 접근 시 “connection refused” 가 발생한다면, 어플리케이션이나 인스턴스 자체의 이슈를 살펴보는 것이 좋다.&lt;/li&gt;
&lt;li&gt;모든 기본적으로 모든 inbound 트래픽은 거부되고, 모든 outbound 트래픽은 인가된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;IP 대신 다른 Security Group 참조하기&lt;/h2&gt;
&lt;p&gt;inbound, outbound 규칙에 IP 대신 다른 Security Group 을 참조할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 751px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bc76f656304d4ee768c8a9b3a8d96fc7/9ae5c/ref_security_group.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAByklEQVQoz2WSa2/aMBSG+f9/ZB9W7UM1adLW2wpbJxUoAQqkIUDIPZAQArmHPHMztdKKpcfHOraOz+vXrdE6Z2qV9LUNC3tBdlBIDvOGVBAfFuxinzAJCOKAtAhQxm1uv39mKt2iGSZ/nl4YTBasnCMt2alQvROyA842hMqG0hVRUIpkueX/UcMp5lRE1GXEx9HqKTvG2pGREaEaK2yth2tIGMsujv5E6CukZUJSxMR5TFEdRf6ZldLHMye4mw1L3WVtemz3Ga3LmwGX112+trtIswHzyT131xf8+PaJ2eiOYDPjkO2J0pB9EpKXIcpzm/urC9TpL1HI4lFSGE6X6F5Ma7ROkBYhPSVCtz00+YHB4xUT6Se62qVKnTNZ1KmYskb6meSZMETd1Lx4YG99yA2BRR1pghVVpIuiCVWWUqaikJBurYbI4wcsbYjtusw1p5Ht7VLRof7qcsHYqDBcYUCmczquyYwJhSNTuHOKwG/IfXHhwUeddOjcfEEWT2I6Dv3RnLG8xNwmtMygwN6VmLsTQeg3Bcks0YlwOzdF9D54LFymEpwExbnk96/QhIJk2+PodIid3xztjpAa/Nuq64bXo/UbvK3rd/4CJCCkMQwyi1EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;다른 Security Group 참조&quot;
        title=&quot;다른 Security Group 참조&quot;
        src=&quot;/static/bc76f656304d4ee768c8a9b3a8d96fc7/9ae5c/ref_security_group.png&quot;
        srcset=&quot;/static/bc76f656304d4ee768c8a9b3a8d96fc7/0eb09/ref_security_group.png 500w,
/static/bc76f656304d4ee768c8a9b3a8d96fc7/9ae5c/ref_security_group.png 751w&quot;
        sizes=&quot;(max-width: 751px) 100vw, 751px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이렇게 다른 Security Group을 참조하면 매번 변경되는 IP 에 대응하지 않아도 된다는 장점이 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AWS S3]]></title><description><![CDATA[S3 S3 는 object (파일) 를 bucket (디렉토리) 에 저장할 수 있게 한다. bucket 이름은 전역적으로 유일해야 한다. (다른 사용자가 사용중인 이름은 사용불가) bucket 은 region…]]></description><link>https://cheong38.github.io/2021-02-06-aws-s3/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-06-aws-s3/index/</guid><pubDate>Sat, 06 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;S3&lt;/h1&gt;
&lt;p&gt;S3 는 &lt;strong&gt;object&lt;/strong&gt; (파일) 를 &lt;strong&gt;bucket&lt;/strong&gt; (디렉토리) 에 저장할 수 있게 한다.&lt;/p&gt;
&lt;p&gt;bucket 이름은 전역적으로 유일해야 한다. (다른 사용자가 사용중인 이름은 사용불가)&lt;/p&gt;
&lt;p&gt;bucket 은 region 수준으로 정의된다.&lt;/p&gt;
&lt;h2&gt;이름 컨벤션&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;대문자 사용 불가&lt;/li&gt;
&lt;li&gt;_(underscore) 사용 불가&lt;/li&gt;
&lt;li&gt;3 ~ 36 글자 사이의 길이&lt;/li&gt;
&lt;li&gt;IP 주소 형식 불가&lt;/li&gt;
&lt;li&gt;소문자나 숫자로 시작해야 함&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Object&lt;/h2&gt;
&lt;p&gt;Object (파일) 은 &lt;strong&gt;key&lt;/strong&gt; 를 가지고 있다.&lt;/p&gt;
&lt;p&gt;key 는 bucket 하위의 전체 경로를 의미한다.&lt;/p&gt;
&lt;p&gt;예:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;s3://my&lt;em&gt;bucket/__my&lt;/em&gt;file.txt__&lt;/li&gt;
&lt;li&gt;s3://my&lt;em&gt;bucket/__my&lt;/em&gt;folder/another&lt;em&gt;folder/my&lt;/em&gt;file.txt__&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;key 는 &lt;em&gt;prefix&lt;/em&gt; + &lt;strong&gt;object_name&lt;/strong&gt; 으로 구성된다.&lt;/p&gt;
&lt;p&gt;예: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;s3://my&lt;em&gt;bucket/&lt;/em&gt;my&lt;em&gt;folder/another&lt;/em&gt;folder/&lt;strong&gt;&lt;em&gt;my&lt;/em&gt;file.txt&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;bucket 안에는 디렉토리 개념이 없지만 UI 적으로는 디렉토리 같은 형식으로 보여준다.
실제로는 단순히 / 를 포함하는 key 가 긴 object 일 뿐이다.&lt;/p&gt;
&lt;p&gt;Object 의 &lt;strong&gt;value&lt;/strong&gt; 는 body 의 내용을 말한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;최대 Object 크기는 5TB 이다.&lt;/li&gt;
&lt;li&gt;그러나 한 번에 5GB 이상을 업로드할 수 없으므로 그 이상의 object 를 업로드하기 위해서는 multi-part upload 를 사용해야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Metadata&lt;/strong&gt; 는 key/value 쌍으로 이루어진 텍스트의 리스트이다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Tag&lt;/strong&gt; 는 최대 10개까지 가질 수 있고, unicode 로된 key/value 쌍이다. 보안이나 라이프사이클을 위해 유용하다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Version ID&lt;/strong&gt; 는 versioning 이 enable 인 경우에 할당되는 versioning 에 대해서는 뒤에 설명 예정이다. &lt;/p&gt;
&lt;h2&gt;S3 Versioning&lt;/h2&gt;
&lt;p&gt;S3 에서는 파일들에 대해 &lt;strong&gt;버전 관리&lt;/strong&gt;를 할 수 있다.
이 버전 관리는 &lt;strong&gt;bucket 수준&lt;/strong&gt; 으로 enable, disable 된다.&lt;/p&gt;
&lt;p&gt;같은 key 로 업로드되는 파일은 1, 2, 3… 과 같이 &lt;strong&gt;증가하는 순서&lt;/strong&gt; 로 버전 관리가 된다. (숫자 형식으로 version ID 가 생성되진 않는다.)&lt;/p&gt;
&lt;p&gt;bucket 에 대해 버전관리를 하는 것이 &lt;strong&gt;Best Practice&lt;/strong&gt; 이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;의도되지 않은 삭제로부터 파일을 지킬 수 있고,&lt;/li&gt;
&lt;li&gt;이전 버전으로 쉽게 롤백할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;versioning 을 enable 하기 전에 업로드된 파일은 version 이 &lt;strong&gt;null&lt;/strong&gt; 기록 기록된다.&lt;/p&gt;
&lt;p&gt;bucket 단위로 versioning 을 &lt;strong&gt;enable&lt;/strong&gt; 하거나 &lt;strong&gt;suspend&lt;/strong&gt; 할 수 있다.
enable 은 versioning 자체를 활성화하는 것이고,
suspend 는 모든 작업에 대해 버전 생성을 일시 중단하지만, 기존 object 의 버전은 유지한다.&lt;/p&gt;
&lt;p&gt;versioning 되고 있는 bucket 에서 object 를 삭제하면, 실제로 삭제되는 것이 아니라 object 에 delete marker 생성하게 된다.
이 delete marker 를 삭제하면, 삭제된 object 를 복구할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[AWS VPC 기본]]></title><description><![CDATA[VPC Virtual Private Cloud 클라우드 상에서 논리적으로 공간을 격리하기 위해 사용한다. VPC 가 없다면 EC…]]></description><link>https://cheong38.github.io/2021-02-03-aws-vpc-basic/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-03-aws-vpc-basic/index/</guid><pubDate>Wed, 03 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;VPC&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;V&lt;/strong&gt;irtual &lt;strong&gt;P&lt;/strong&gt;rivate &lt;strong&gt;C&lt;/strong&gt;loud&lt;/p&gt;
&lt;p&gt;클라우드 상에서 논리적으로 공간을 격리하기 위해 사용한다.&lt;/p&gt;
&lt;p&gt;VPC 가 없다면 EC2 인스턴스들이 서로 혹은 인터넷과 스파게티처럼 연결될 것이다. 이렇게 되면 시스템의 복잡도가 엄청나게 올라간다.
최악의 경우, 하나의 인스턴스를 추가하는 데에 거의 모든 인스턴스를 수정해야 하는 상황이 발생할 수 있다.
EC2 인스턴스를 VPC 로 묶고, VPC 별로 네트워크 설정을 해준다면, 이 복잡도를 완화시킬 수 있다.&lt;/p&gt;
&lt;h2&gt;VPC in AWS&lt;/h2&gt;
&lt;p&gt;region 별로 복수의 VPC 를 생성할 수 있는데, 최대 5개까지 생성 가능한다. (이 limit 은 AWS 에 요청하여 늘릴 수 있다.)&lt;/p&gt;
&lt;p&gt;CIDR 는 VPC 당 최대 5개 이며, 각각의 CIDR 는 아래와 같은 제한을 갖는다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;최소 서브넷 크기는 /28 = 16 개의 IP&lt;/li&gt;
&lt;li&gt;최대 서브넷 크기는 /16 = 65,536 개의 IP&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VPC 는 private 이기 때문에, 오직 private IP 대역만 허용한다.&lt;/p&gt;
&lt;p&gt;VPC CIDR 는 가지고 있는 다른 네트워크의 CIDR 와 겹쳐서는 안된다.&lt;/p&gt;
&lt;p&gt;CIDR 와 public, private IP 에 대한 설명은 &lt;a href=&quot;/2021-02-02-cidr-public-private-ip/index/&quot;&gt;지난 포스팅&lt;/a&gt; 을 참고한다.&lt;/p&gt;
&lt;h2&gt;Default VPC (기본 VPC)&lt;/h2&gt;
&lt;p&gt;AWS 에서는 새로 계정을 생성하면 region 별로 기본 VPC 를 생성하여 제공한다.&lt;/p&gt;
&lt;p&gt;기본 VPC 는 인터넷 연결을 가지고 있고, 모든 인스턴스는 public IP 를 갖게 된다.&lt;/p&gt;
&lt;p&gt;또한, public, private DNS 이름도 갖게 된다.&lt;/p&gt;
&lt;h2&gt;Subnets in VPC&lt;/h2&gt;
&lt;p&gt;VPC 의 subnet 은 AZ(Availability Zone) 에 종속된다. VPC 내에 다수의 subnet 을 생성할 수 있다.
이 때, subnet 의 CIDR 는 VPC 의 CIDR 범위 안에 있어야 한다.&lt;/p&gt;
&lt;p&gt;public subnet 은 인터넷에 연결된 subnet 을 말하고, private subnet 은 인터넷에 연결되지 않은 subnet 을 말한다.&lt;/p&gt;
&lt;p&gt;일반적으로 public subnet 은 private subnet 에 비해 작은 CIDR 를 갖는다.&lt;/p&gt;
&lt;p&gt;AWS 는 각 subnet 별로 5개의 IP 주소를 예약한다. (첫 4개 + 마지막 1개)&lt;/p&gt;
&lt;p&gt;예: 10.0.0.0/24 CIDR 블록에 대해&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;10.0.0.0: 네트워크 주소&lt;/li&gt;
&lt;li&gt;10.0.0.1: VPC 라우터를 위해 예약&lt;/li&gt;
&lt;li&gt;10.0.0.2: 아마존에서 제공하는 DNS 매핑을 위해 예약&lt;/li&gt;
&lt;li&gt;10.0.0.3: 향후 사용을 위해 예약&lt;/li&gt;
&lt;li&gt;10.0.0.255: 네트워크 브로드캐스트 주소 (AWS 는 VPC 내 브로드캐스트를 지원하지는 않는다. 단순히 예약되어있어 사용은 불가.)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Internet Gateway (IGW)&lt;/h2&gt;
&lt;p&gt;IGW 는 VPC 인스턴스가 인터넷에 연결될 수 있게 한다.
IGW 를 설정하지 않으면, public IP 를 할당 받더라도 EC2 인스턴스는 인터넷에 연결되지 않는다.&lt;/p&gt;
&lt;p&gt;IGW 는 VPC 와 분리되어 생성된다.&lt;/p&gt;
&lt;p&gt;VPC 는 오직 하나의 IGW 에 attach 될 수 있으며, IGW 역시 하나의 VPC 를 attach 할 수 있다.&lt;/p&gt;
&lt;p&gt;IGW 자체로는 인터넷 접근을 허용할 수는 없으며, Route table 이 같이 편집되어야 한다.&lt;/p&gt;
&lt;h2&gt;NAT 인스턴스&lt;/h2&gt;
&lt;p&gt;NAT: &lt;strong&gt;N&lt;/strong&gt;etowrk &lt;strong&gt;A&lt;/strong&gt;ddress &lt;strong&gt;T&lt;/strong&gt;ranslation&lt;/p&gt;
&lt;p&gt;(Outdated 되어 사용을 권하진 않음, &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/VPC_NAT_Instance.html&quot;&gt;참고&lt;/a&gt;) &lt;/p&gt;
&lt;p&gt;NAT 인스턴스는 private subnet 을 인터넷에 연결할 수 있게 한다.&lt;/p&gt;
&lt;p&gt;public subnet 에 런치되어야 한다.&lt;/p&gt;
&lt;p&gt;EC2 의 Source/Destination Check 플래그를 disable 해야 한다.&lt;/p&gt;
&lt;p&gt;Elastic IP 가 attach 되어 있어야 한다.&lt;/p&gt;
&lt;p&gt;Route table 이 private subnet 으로부터 NAT 인스턴스로 route 하도록 설정되어 있어야 한다.&lt;/p&gt;
&lt;p&gt;즉, public subnet 에 인스턴스를 하나 띄워서 private subnet 의 인스턴스가 그 인스턴스를 통해 인터넷에 접근하도록 만드는 것이다.&lt;/p&gt;
&lt;p&gt;NAT 인스턴스는 Community AMI 에서 검색하여 사용하면 된다. &lt;/p&gt;
&lt;h3&gt;단점&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;인스턴스의 유형에 따라 성능의 차이를 보일 수 있다. (micro 와 같이 작은 인스턴스 사용시에는 네트워크 성능이 저하될 수 있음)&lt;/li&gt;
&lt;li&gt;새로운 포트의 개방이 필요할때마다 NAT 인스턴스의 security group 을 수정해주어야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;NAT Gateway&lt;/h2&gt;
&lt;p&gt;NAT gateway 는 NAT 인스턴스의 대안으로 사용하면 된다. NAT 인스턴스의 기능을 AWS 에서 managed 서비스로 제공하는 것이다.&lt;/p&gt;
&lt;p&gt;지정된 AZ 에 Elastic IP 를 사용하여 NAT gateway 를 생성하게 된다.&lt;/p&gt;
&lt;p&gt;NAT Gateway 가 설정된 subnet 안의 인스턴스는 사용이 불가하고 다른 subnet 의 인스턴스만 사용이 가능하다.&lt;/p&gt;
&lt;p&gt;NAT Gateway 는 Internet Gateway 를 필요로 한다. (Private Subnet =&gt; NAT =&gt; IGW)&lt;/p&gt;
&lt;p&gt;45Gbps 까지 bandwidth 가 자동적으로 스케일업이 가능하다.&lt;/p&gt;
&lt;p&gt;Security Group 을 생성하고 관리할 필요가 없다.&lt;/p&gt;
&lt;p&gt;NAT 인스턴스와 NAT Gateway 의 비교는 &lt;a href=&quot;https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-nat-comparison.html&quot;&gt;이 문서&lt;/a&gt; 를 보면 자세히 나와 있다.&lt;/p&gt;
&lt;h2&gt;Network ACLs (NACL)&lt;/h2&gt;
&lt;p&gt;NACL 은 subnet 에 적용되는 firewall 이라 생각하면 된다.
하나의 subnet 당 하나의 NACL 이 있으며, 새로 생성된 subnet 에서는 Default NACL 이 할당된다.
Default NACL 은 모든 outbound, inbound 트래픽을 허용한다.
단, 새로 임의로 생성한 NACL 은 모든 outbound, inbound 트래픽을 deny 하도록 생성된다. &lt;/p&gt;
&lt;p&gt;NACL 은 다음과 같은 규칙을 정의한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;규칙은 1 ~ 32766 의 숫자를 갖고, 낮은 숫자일수록 우선순위가 높다.&lt;/li&gt;
&lt;li&gt;마지막 규칙은 asterisk(*) 이고 다른 모든 규칙이 매칭되지 않을 때의 행동을 정의한다.&lt;/li&gt;
&lt;li&gt;AWS 에서는 규칙별로 100단위로 숫자를 할당하는 것을 권장한다. (추후 중간에 규칙을 끼워넣을 수 있도록)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;NACL 은 subnet 수준에서 특정한 IP 를 블록하는 좋은 수단이다. &lt;/p&gt;
&lt;h3&gt;Network ACLs vs Security Group (SG)&lt;/h3&gt;
&lt;p&gt;NACL 은 subnet 단위, SG 는 EC2 인스턴스 단위의 규칙이라는 점에서 가장 크게 차이점이 있다.&lt;/p&gt;
&lt;p&gt;NACL 은 allow, deny 규칙을 지원하지만, SG 는 allow 규칙만 지원한다.&lt;/p&gt;
&lt;p&gt;또한 NACL 은 stateless 지만, SG 는 stateful 하다.
(stateless: 규칙에 명시되어 있는대로만 행동함, stateful: return 트래픽에 대해서는 규칙에 상관없이 허용됨)&lt;/p&gt;
&lt;p&gt;이 외의 NACL 와 SG 의 차이점은 &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Security.html&quot;&gt;이 문서&lt;/a&gt; 를 참조하도록 하자.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CIDR, Public/Private IP]]></title><description><![CDATA[개요 인터넷에서는 통신한 컴퓨터를 찾기 위해 IP 주소를 사용한다.
이번 포스팅에서는 IP 주소의 범위를 표기하는 방식인 CIDR 과 public, private IP 개념에 대해 다룬다. CIDR Classless Inter-Domain…]]></description><link>https://cheong38.github.io/2021-02-02-cidr-public-private-ip/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-02-cidr-public-private-ip/index/</guid><pubDate>Tue, 02 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;인터넷에서는 통신한 컴퓨터를 찾기 위해 IP 주소를 사용한다.
이번 포스팅에서는 IP 주소의 범위를 표기하는 방식인 CIDR 과 public, private IP 개념에 대해 다룬다.&lt;/p&gt;
&lt;h1&gt;CIDR&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;C&lt;/strong&gt;lassless &lt;strong&gt;I&lt;/strong&gt;nter-&lt;strong&gt;D&lt;/strong&gt;omain &lt;strong&gt;R&lt;/strong&gt;outing&lt;/p&gt;
&lt;p&gt;CIDR 은 IP 의 범위를 정의하는데 사용된다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;WW.XX.YY.ZZ/MM&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;위와 같은 형태로 표기된다.&lt;/p&gt;
&lt;p&gt;여기서 &lt;code class=&quot;language-text&quot;&gt;WW.XX.YY.ZZ&lt;/code&gt; 는 흔히 우리가 사용하는 IP 주소이며, &lt;code class=&quot;language-text&quot;&gt;MM&lt;/code&gt; 은 0 ~ 32 사이의 정수이다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WW.XX.YY.ZZ&lt;/code&gt; 부분을 &lt;strong&gt;base IP&lt;/strong&gt; 라고 하고 &lt;code class=&quot;language-text&quot;&gt;/MM&lt;/code&gt; 부분을 &lt;strong&gt;subnet mask&lt;/strong&gt; 라고 한다.&lt;/p&gt;
&lt;p&gt;base IP 는 IP 범위 안에 포함되는 IP 하는 표현하고,
subnet mask 는 IP 주소 내에 얼마나 많은 비트가 변할 수 있는지를 표현한다.&lt;/p&gt;
&lt;h2&gt;Subnet mask 이해하기&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Subnet mask&lt;/th&gt;
&lt;th&gt;IP 개수&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/32&lt;/td&gt;
&lt;td&gt;2^0 = 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/31&lt;/td&gt;
&lt;td&gt;2^1 = 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/30&lt;/td&gt;
&lt;td&gt;2^2 = 4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/29&lt;/td&gt;
&lt;td&gt;2^3 = 8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/28&lt;/td&gt;
&lt;td&gt;2^4 = 16&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/24&lt;/td&gt;
&lt;td&gt;2^8 = 256&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/16&lt;/td&gt;
&lt;td&gt;2^16 = 65,536&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/0&lt;/td&gt;
&lt;td&gt;all&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;자주 사용하는 값은 아래와 같다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Subnet mask&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;/32&lt;/td&gt;
&lt;td&gt;어떤 IP 숫자도 변경될 수 없다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/24&lt;/td&gt;
&lt;td&gt;마지막 IP 숫자 한개가 변경될 수 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/16&lt;/td&gt;
&lt;td&gt;마지막 IP 숫자 2개가 변경될 수 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/8&lt;/td&gt;
&lt;td&gt;마지막 IP 숫자 3개가 변경될 수 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;/0&lt;/td&gt;
&lt;td&gt;모든 IP 숫자가 변경될 수 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;연습&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;192.168.0.0/24&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=&gt; &lt;em&gt;192.168.0.0 ~ 192.168.0.255 (256 개의 IP)&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;10.1.0.0/16&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=&gt; &lt;em&gt;10.1.0.0 ~ 10.1.255.255 (65,536 개의 IP)&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;172.168.0.1/32&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=&gt; &lt;em&gt;172.168.0.1 오직 한 개&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0.0.0.0/0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;=&gt; &lt;em&gt;모든 IP&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;계산을 확실히 확인하고 싶다면, &lt;a href=&quot;https://www.ipaddressguide.com/cidr&quot;&gt;ipaddressguide 웹사이트&lt;/a&gt; 를 확인하면 좋다.&lt;/p&gt;
&lt;h1&gt;Public vs Private IP (IPv4)&lt;/h1&gt;
&lt;p&gt;IANA(Internet Assigned Numbers Authority) 는 IP 주소를 public 과 private 구역으로
나누어서 설정하였다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Private IP 구역&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;IP 범위&lt;/th&gt;
&lt;th&gt;CIDR&lt;/th&gt;
&lt;th&gt;사용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;10.0.0.0 ~ 10.255.255.255&lt;/td&gt;
&lt;td&gt;(10.0.0.0/8)&lt;/td&gt;
&lt;td&gt;큰 네트워크에 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;172.16.0.0 ~ 172.31.255.255&lt;/td&gt;
&lt;td&gt;(172.16.0.0/12)&lt;/td&gt;
&lt;td&gt;AWS 의 기본 private IP 로 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;192.168.0.0 ~ 192.168.255.255&lt;/td&gt;
&lt;td&gt;(192.168.0.0/16)&lt;/td&gt;
&lt;td&gt;홈 네트워크에 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;Public IP 구역&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Private IP 구역을 제외한 모든 구역이 Public IP 구역이다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[마켓 리더의 조건 (시장의 지배자가 되고 그것을 존속하려면 무엇이 필요한가?) 2/2]]></title><description><![CDATA[이 포스팅은 지난 포스팅 에 이은 2부이다.…]]></description><link>https://cheong38.github.io/2021-02-01-market-leader-2/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-02-01-market-leader-2/index/</guid><pubDate>Mon, 01 Feb 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;이 포스팅은 &lt;a href=&quot;/2021-01-31-market-leader/index/&quot;&gt;지난 포스팅&lt;/a&gt; 에 이은 2부이다.&lt;/p&gt;
&lt;h1&gt;6장&lt;/h1&gt;
&lt;p&gt;크게 성공한 제품들을 언뜻 보면 운에 크게 기인한 것으로 보인다. 적당한 시기, 적당한 곳에 제품이 등장했다는 것이다.&lt;/p&gt;
&lt;p&gt;하지만 기업가와 경영자들은 극복하기 힘들어 보이는 장애물, 더딘 발전, 오랜 시간에도 불구하고 계속 노력하겠다는 의지가 있어야 한다.
이 노력을 하기 위해서는 미래를 예견하는 비전이 있어야 한다. 이 부분이 중요하다고 생각한다. 아무런 비전 없이는 노력할 수 없다.
또 반대로 노력만 한다고 성공하는 것이 아니다.&lt;/p&gt;
&lt;p&gt;단순해 보이는 일회용 안전 면도기 역시 그 뒷면에는 혁신적인 기술을 도입하기 위한 엄청난 끈기가 있었다.&lt;/p&gt;
&lt;p&gt;질레트는 처음엔 그저 면도기와 면도날 두 부분으로 나누어져 평평하고 값싼 금속으로 만든 면도날이 무뎌지면 버려도 되는 면도기를 생각했다.
그리고 이 정도의 디자인은 쉽게 만들 수 있을 거라 생각했다. 하지만 아무도 그의 이야기에 귀를 기울이는 사람은 없었다.
그래서 그는 시제품을 만들기 위해 면도날 개발에 힘을 쏟았다.
먼저 얇은 철판을 이용해서 면도날을 개발했는데, 얇은 철판은 너무 부서지기 쉽고, 약해서 날카롭게 날을 유지하지 못했다.
전문가들을 찾아가면 한결같이 얇은 철판으로는 날카로운 날을 만들 수 없다고 했다.
그렇게 질레트는 6년동안 면도날 개발에 매달렸다.
그 다음으로 시도한 특허도 첫 번째 시도는 실패했고, 몇 달이나 걸려서 다시 특허를 신청해서야 특허를 얻을 수 있었다.
이어서 그는 대량 생산을 할 수 있는 제조 시스템을 개발해야 했다.&lt;/p&gt;
&lt;p&gt;이 책에서는 이 외에 P&amp;#x26;G, 소니 등의 사례를 들면서 자금력이 있는 기업이라 할 지라도 혁신적인 아이디어를 실행하는데는 오랜 시간과 끈기가 필요하다는 것을 역셜하고 있다.&lt;/p&gt;
&lt;p&gt;나는 아이디어는 사업에 있어서 많이 쳐줘봐야 10% 정도를 차지한다고 생각한다.
CEO 의 E 가 괜히 Execution 이 아니다.
훌륭한 아이디어를 낼 수 있는 사람은 얼마 없지만, 어떤 아이디어든 그걸 실행할 수 있는 사람은 그것보다 훨씬 적을 것이다.
아무리 간단한 아이디어라 할지라도 실제 실행은 그리 간단하지 않은 경우가 허다한 것 같다.&lt;/p&gt;
&lt;p&gt;사람들은 크게 성공한 기업에 쉽게들 “행운”이 있었다라고 말한다. 실제로 사업판에는 운칠기삼이라는 말이 있기도하다.
하지만 그 이면을 들여다보면, 아무도 비전을 믿어주지 않을때 꿋꿋이 밀고 나가며 뚝심있게 버티는 시기들이 있었다.
이는 제록스, 마이크로소프트 등과 같은 기업도 예외는 아니다. 역시 기회는 준비된 사람들에게 주어지는 것이다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[마켓 리더의 조건 (시장의 지배자가 되고 그것을 존속하려면 무엇이 필요한가?) 1/2]]></title><description><![CDATA[개요 한 달 쯤 전 지인에게 추천 받아  이라는 책을 읽어보게 되었다. 이 책은 높은 시장 점유율을 갖는 (일반적으로 1위) 업체들은 어떤 특징을 가지고 있는지를 10년이 넘는 기간 동안 분석하여 그에 대한 결과를 서술하고 있다. 1장…]]></description><link>https://cheong38.github.io/2021-01-31-market-leader/index/</link><guid isPermaLink="false">https://cheong38.github.io/2021-01-31-market-leader/index/</guid><pubDate>Sun, 31 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;한 달 쯤 전 지인에게 추천 받아 &lt;code class=&quot;language-text&quot;&gt;마켓 리더의 조건&lt;/code&gt; 이라는 책을 읽어보게 되었다.&lt;/p&gt;
&lt;p&gt;이 책은 높은 시장 점유율을 갖는 (일반적으로 1위) 업체들은 어떤 특징을 가지고 있는지를 10년이 넘는 기간 동안 분석하여 그에 대한 결과를 서술하고 있다.&lt;/p&gt;
&lt;h1&gt;1장&lt;/h1&gt;
&lt;p&gt;1장을 읽으면서는 &lt;a href=&quot;http://www.yes24.com/Product/Goods/15182767&quot;&gt;제로투원&lt;/a&gt; 이라는 책의 내용이 떠올랐다.
제로투원을 보면, 아래와 같은 질문이 나온다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;정말 중요한 진실인데 남들이 당신한테 동의해주지 않는 것은 무엇입니까?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;마켓 리더의 조건 1장은 시장 개척자가 정말 축복 받은 것인가? 전통적인 마케팅 법칙이라 생각했던 시장 개척 및 선점의 유리에 대한 상식에 의문을 제기한다.&lt;/p&gt;
&lt;h2&gt;시장 개척자이론에서 말하는 시장 개척자의 이점&lt;/h2&gt;
&lt;p&gt;일반적으로 시장 개척자들은 아래와 같은 항목에서 유리한 점을 갖는다고 한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;기억의 편리함&lt;/li&gt;
&lt;li&gt;브랜드 충성도&lt;/li&gt;
&lt;li&gt;소비자의 타성&lt;/li&gt;
&lt;li&gt;특허 장벽&lt;/li&gt;
&lt;li&gt;경험의 경제&lt;/li&gt;
&lt;li&gt;자원 동원&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;시장 개척자 이론의 함정&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;시장 개척자&lt;/code&gt; 라는 용어에 대한 정의가 명확하지 않다.&lt;/li&gt;
&lt;li&gt;일찍 시장에 진출한 회사 중 하나인가?&lt;/li&gt;
&lt;li&gt;가장 빠르게 제품을 낸 기업/사람을 의미하는 것인가?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;등 명확한 정의가 내려져 있지 않다.&lt;/p&gt;
&lt;p&gt;그리고 실제로 시장에 가장 빠르게 진출하고 제품을 낸 기업들이 후발 주자에 의해 뒤쳐지거나 사라지는 사례는 셀 수 없이 많다.&lt;/p&gt;
&lt;p&gt;안전 면도기의 경우, 질레트가 시장 개척자로 알고 있지만 사실은 20년도 전에 안전 면도기 제품은 이미 시장에 존재했었다.
하지만 우리는 그 업체가 어떤 업체인지 어떤 브랜드인지 기억조차 못한다.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;시장을 리드하는 기업들은 &lt;code class=&quot;language-text&quot;&gt;자기 신성화&lt;/code&gt; 경향을 가지고 있다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;사실 본인 기업이 최초 제품 개발자가 아니라하더라도 그 이전의 실패한 회사들을 잘 모르고 스스로를 시장 개척자로 생각하는 경향이 있다는 것이다.
이를 self-report 편향이라 부른다. 이 편향 때문에 진짜 성공한 이유가 시장의 선두 진출 혹은 개척이 아님에도 불구하고 그렇게 인터뷰되는 경우가 많다.&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;실패에 대한 망각&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;GE 에서 진행한 과학 경영의 결과물인 PIMS (Profit Impact of Market Strategy) 의 자료가 시장 개척자 이론의 근거로 사용되고 있다.
하지만 이 PIMS 자료에서 중요한 점은 시장에서 실패한 기업에 대한 평가나 지표는 누락되어 있다는 것이다.&lt;/p&gt;
&lt;p&gt;실패한 기업까지 모두 감안한다면 과연 시장에 가장 빠르게 진출한 기업이 여전히 유리하다고 나올까?&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;자기본위적 시장 정의&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;자기본위라 함은 자신에게 이로운 방향으로 무언가를 생각하는 것을 말한다. 즉, 시장 개척자 조사를 할때 조사에 유리한 방향으로 시장을 정의하기 마련이라는 것이다.
시장이라는 것은 좁게 정의하면 어떤 기업이든 그 시장에서 개척자, 리더가 될 수 있다. 그래서 시장을 어떻게 정의하느냐에 따라 시장 개척자 혹은 리더의 기준이 달라질 수 있는 것이다.&lt;/p&gt;
&lt;p&gt;제로투원에서는 독점 기업일수록 오히려 독점 사실을 숨기려 하고, 자신의 타겟 시장을 크게 만들어 시장 점유율을 낮추려 한다는 내용이 있었다.&lt;/p&gt;
&lt;p&gt;그 부분과 매칭되어 인상 깊게 와닿았던 부분이다.&lt;/p&gt;
&lt;h1&gt;2장&lt;/h1&gt;
&lt;p&gt;이번 장에서는 필자들이 접근한 방식인 역사적 방법에 대해 설명하고, 이 방법이 왜 유용한지에 대해 설명한다.
여러가지 이유 중에서 그 시대의 시각으로 현재의 마켓 리더 기업에 대한 평가를 볼 수 있다는 점이 좋게 생각되었다.
현재의 결과로 보면, 이미 성공했고, 리더의 위치에 있는 기업이 초기에는 어떤 평가를 받았는지를 살펴보는 것은 흥미롭게 느껴졌다.&lt;/p&gt;
&lt;p&gt;그 후에는 조사 샘플을 결정한 기준에 대해 설명하였는데, 여러 가지로 생각하면서 나름 체계적이고 객관적이려고 노력했구나 생각이 들었다.&lt;/p&gt;
&lt;p&gt;그래서 이 책에서는 1990년 ~ 2001년의 기간 동안 총 66개의 시장을 대상으로 역사적 방법을 통해 마켓 리더 기업의 공통점(조건)을 조사하고 그에 대한 고찰을 기록한 책이 되겠다.&lt;/p&gt;
&lt;p&gt;2장에서 특별히 인상 깊었던 점이 있다기 보다는 빨리 다음 장으로 넘어가서 “그래서 결론이 뭐야? 마켓 리더의 조건이 뭔데?” 라는 조바심이 들었다.&lt;/p&gt;
&lt;h1&gt;3장&lt;/h1&gt;
&lt;p&gt;그렇다면, 현재 시장에서 지배적인 위치에 있고, 그리고 그 위치를 오랜 기간동안 존속시키는 비결은 무엇일까?&lt;/p&gt;
&lt;p&gt;이 책에서는 시장 개척자를 다음과 같이 정의한다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;시장에 제품을 가장 먼저 출시한 기업&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;그리고 시장 지배자(리더)는 아래와 같이 정의한다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;시장 지배력을 획득하고 비교적 오랜 기간 지배력을 지속하고 있는 기업&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;여기서 시장 지배력이란 한 제품 부분에서 최고의 시장 점유율을 가지고 있는 것을 나타낸다.&lt;/p&gt;
&lt;p&gt;시장 지배자의 정의에 대해 조금 아쉬운 점이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;비교적 오랜 기간의 지배력이란 어느 정도 기간을 의미하는가?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;-&gt; 이 부분도 명시적으로 나와 있지는 않다. 앞 선 책의 내용을 참고삼아 추측해자면 5 ~ 10년 이상을 기준으로 삼고 있지 않을까 싶다.&lt;/p&gt;
&lt;p&gt;이번 장의 내용에 따르면, 시장 개척자와 시장 지배자의 상관 관계는 크게 없다고 한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;시장 개척자의 실패 확률을 무려 64% 에 이른다.&lt;/li&gt;
&lt;li&gt;시장 개척자의 시장 점유율을 고작 6% 정도 밖에 안된다.&lt;/li&gt;
&lt;li&gt;시장 개척자가 시장 지배자가 되는 경우의 수는 66개 샘플 중 6개 정도였다. (10% 미만)&lt;/li&gt;
&lt;li&gt;시장 개척자가 시장 지배자가 되더라도 반 수 이상은 5년을 버티지 못했다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;더불어 현재의 시장 지배자들은 시장 개척자들에 비해 시장 진출이 평균 19년 정도 늦은 것으로 나타났다.
이 중 흥미롭게 본 시장 부분은 디지털/하이테크 부분인데 이 부문의 시장 진출 시기 차이는 평균 &lt;strong&gt;7년&lt;/strong&gt; 정도로 나타나 역시 꽤나 빠르게 움직이는 시장이구나를 실감할 수 있었다.&lt;/p&gt;
&lt;p&gt;이 책에서는 지속적인 리더가 될 수 있는 조건으로 다음과 같은 5가지를 꼽았다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;비전 (Vision)&lt;/li&gt;
&lt;li&gt;끈기 (Persistence)&lt;/li&gt;
&lt;li&gt;혁신 (Innovation)&lt;/li&gt;
&lt;li&gt;헌신 (Commitment)&lt;/li&gt;
&lt;li&gt;자산 레버리지 (Asset Leverage)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;그리고 끈기, 혁신, 헌신, 자산 레버리지 이 4가지를 묶어서 &lt;strong&gt;의지(Will)&lt;/strong&gt; 이라고 지칭하였다.
이 책의 표지의 서브 타이틀(Will &amp;#x26; Vision)과 통하는 내용이었다.&lt;/p&gt;
&lt;h2&gt;비전 (Vision)&lt;/h2&gt;
&lt;p&gt;이 책에서 말하는 비전은 대량 시장을 목표로 하는 비전이었다. 틈새 시장 전략보다는 대량 소비 시장을 타겟으로 해야 하는 이유를 설명한다.&lt;/p&gt;
&lt;p&gt;비전의 2 가지 중요한 구성 요소로 다음을 소개한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;비전은 역동적이고 발전적 욕구를 지닌 대량 소비시장을 집중 겨낭한다.&lt;/li&gt;
&lt;li&gt;비전은 대량 소비시장의 욕구를 파악하고 충족시킬 수 있는 특별한 전망을 가지고 있다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;마케팅 서적이나 이론에서 보면 창을 날카롭게 만들어서 시장을 뚫고 들어갈 수 있는 특별한 특장점을 만들고 이를 USP(Unique Sales Point)로 잡아서 시장에
진출하는 것을 정론으로 생각하고 있었는데, 나에게는 나름 충격적인 주장이었다. 이에 대해서는 천천히 곱씹어보면서 생각해보려한다.&lt;/p&gt;
&lt;h2&gt;끈기 (Persistence)&lt;/h2&gt;
&lt;p&gt;많은 매체에서 성공한 기업은 운이 좋아서, 마침 시장에 타이밍이 좋았다고 소개를 하는 경우가 많다.
하지만 시장 지배자의 실상을 들여다보면, 많은 장애물을 겪었으며 굉장히 오랜 기간 제품 개발과 연구에 매진했던 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;일례로 소니(Sony)는 비디오 녹화기를 개발하는데 무려 20년이라는 시간을 쏟아부었다고 한다.&lt;/p&gt;
&lt;p&gt;한국 스타트업 세계에는 &lt;strong&gt;운칠기삼(운이 70 퍼센트이고, 실력은 30%이다.)&lt;/strong&gt;이라는 말이 팽배해있고, 나도 상당 부분 동의하고 있었다.
더불어 &lt;strong&gt;인생은 타이밍&lt;/strong&gt; 이라고 하지 않던가? 이런 말에 의미를 부여하고 자위하고 있던 내가 부끄러워지는 순간이었다.&lt;/p&gt;
&lt;h2&gt;혁신 (Innovation)&lt;/h2&gt;
&lt;p&gt;앞서서는 단순히 혁신이라고 소개했지만, 이 책의 소제목에는 &lt;strong&gt;부단한&lt;/strong&gt; 혁신이라고 쓰여있다.
한 때 성공했던 제품이라도 기술과 시장의 변화에 쓸모없는 제품이 되기도 한다.
자사의 제품을 시장에서 몰아낼지라도 부단히 혁신해야 지속적인 시장 지배력을 가질 수 있다고 말하고 있다.&lt;/p&gt;
&lt;h2&gt;헌신 (Commitment)&lt;/h2&gt;
&lt;p&gt;역시 단순한 헌신이 아니라 &lt;strong&gt;금융&lt;/strong&gt; 헌신이라는 소제목으로 쓰여있다.
종종 시장에 진출하고 제품을 개발하는 일은 막대한 금액을 필요로 하기도 한다.
이를 위해 창업자가 개인의 자금을 헌납하거나 외부에서 자금을 모은 회사만이 시장 지배력을 가진 회사가 될 수 있다고 한다.&lt;/p&gt;
&lt;p&gt;회사를 운영하면서 자금의 중요성은 더 말로 표현할 필요는 없을 것이다. 백 번 옳은 말이다.&lt;/p&gt;
&lt;h2&gt;자산 레버리지 (Asset Leverage)&lt;/h2&gt;
&lt;p&gt;지속적인 시장 지배자는 새로운 부문에서 기반을 잡기 위해 현재 자산을 기꺼이 레버리지하곤 한다고 한다.
이 결정이 쉽지 않은 이유는 신제품부분이 기존 제품의 사업 부문을 와해시킬 수 있는데, 기업에서는 이런 결정을 내리기가 쉽지 않기 때문이다.&lt;/p&gt;
&lt;p&gt;아직 이런 상황까지 마주해본 적은 없지만 향후 기회가 되어 이런 상황이 온다면, 이 챕터를 잊지 말아야겠다.&lt;/p&gt;
&lt;h2&gt;의지와 비전 (Will &amp;#x26; Vision)&lt;/h2&gt;
&lt;p&gt;의지는 끈기, 혁신, 헌신, 자산 레버리지로 이루어진다. 그리고 이 의지의 출발점은 비전이다.
비전은 다른 네 가지 요소들의 원동력이자 안내자이다.&lt;/p&gt;
&lt;p&gt;앞 서 말한 요소들을 모두 가지고 있거나 대부분 가지고 있는 회사들이 지속적인 시장 지배자로 남고,
하나 이상 부족했던 시장 개척작들은 실패했다고 한다.&lt;/p&gt;
&lt;p&gt;나머지 일곱 장에서는 이 요소들은 하나하나 설명한다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 667px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/158786d7d8774be86d746777680fd711/e31cc/will_and_vision.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 67.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABTElEQVQ4y52Uy4qEMBBF8/9f5MZlrwRdKL5AfKIuGhV8a3fXcDOUOGlmxpmCwkStk1s3UVHXNU3TRPM80zAMNI4jIV6v13Hl8ZUQvu8fk+fzScuyvIH+AhVd10l1HG3bSqUcKvhX4O12I8MwKAgCStNUtg9g0zS0rusb+KdEhyJJEkLCS/gHIGLfd4J6gLdt+6LirFRVLzDo+14WwT+1GM+gFIlFHo+HVIL3eIwrAsIEBlDCN9X2OGADLMnznMIwlF5nWUZRFMmM45g0TfsEoq3vgAyFFSj0PI9M06SqqshxHLJt+0gJxA7f73fpH8bcMoO4TQDxjM2HBbjPbSMsyyLhuu6hBAV8hDAHBIvBRwQDzt5xYmG5KXyQ+WADCBBsAIhXv/ylwFxuE8WYq6ArZ5BT6Loud4hbOitWN+bSl1IUBZVlefhy9vA/P4cP5JBEneWb7LsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Will &amp;amp; Vision&quot;
        title=&quot;Will &amp;amp; Vision&quot;
        src=&quot;/static/158786d7d8774be86d746777680fd711/e31cc/will_and_vision.png&quot;
        srcset=&quot;/static/158786d7d8774be86d746777680fd711/0eb09/will_and_vision.png 500w,
/static/158786d7d8774be86d746777680fd711/e31cc/will_and_vision.png 667w&quot;
        sizes=&quot;(max-width: 667px) 100vw, 667px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1&gt;4장&lt;/h1&gt;
&lt;p&gt;비전을 구성하는 필수요소는 &lt;strong&gt;대량 소비시장&lt;/strong&gt;을 타겟하는 것이다.&lt;/p&gt;
&lt;p&gt;하지만 이는 마케터가 기피하는 대상이다. 마케터는 시장을 세분화하고 그 세분화한 타겟의 욕구에 맞춰 제품의 디자인을 바꾸는 전략을 취한다.
나 역시 이를 마케팅의 정석으로 배웠었다. IR 덱을 작성할 때도 시장을 크게 잡으면 비현실적이라는 지적을 듣곤했다.&lt;/p&gt;
&lt;p&gt;하지만, 이 책에서는 세 가지 중요한 이득을 예로 들면서 대량 소비시장에 중점을 두는 것이 중요하다고 말한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;대량 소비시장에 도달하기 위해서는 그 시장이 원하는 가격을 목표로 삼아야 하는데, 이는 경영자로 하여금 모든 연구 과정과
생산 노력을 가격에 맞게 조절할 수 있게 한다.&lt;/li&gt;
&lt;li&gt;일단 대량 소비시장의 문이 열리면, 원가를 낮출 수 있는 규모의 경제가 가능하다.&lt;/li&gt;
&lt;li&gt;대량 소비시장을 겨냥한 대규모 운영방식은 연구에 많은 노력을 쏟아 붓는 일을 쉽게 지원할 수 있다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이 부분을 읽으면서도 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;정말 중요한 진실인데 남들이 당신한테 동의해주지 않는 것은 무엇입니까?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이 구절이 떠올랐다.&lt;/p&gt;
&lt;p&gt;대량 소비시장을 목표로 하여 성공했던 기업과 브랜드의 예시로 P&amp;#x26;G 의 종이기저귀를 예로 들었다.&lt;/p&gt;
&lt;p&gt;당시 종이 기저귀의 가격은 개당 8.6 센트였고, 천 기저귀의 세탁 비용은 3.5센트였다.
그래서인지 소비자들은 아기를 동반하고 여행을 갈 때에만 종이 기저귀를 사용했다.
즉, 대량 소비시장의 문을 여는데 종이 기저귀의 높은 가격이 큰 장애물이 되었다.
P&amp;#x26;G 는 6센트의 낮은 가격으로 우수한 종이 기저귀를 생산해 대량 소비시장을 뚫기로 결심했다.
그러기 위해서 제조 단가는 3센트로 낮춰야 했다. P&amp;#x26;G 는 그 비전을 믿고 10년을 조사했다.
그리고 결국 3센트짜리 기저귀를 생산할 수 있는 제조시스템을 마련했고, 이는 P&amp;#x26;G 의 종이 기저귀 매출을 3억 7천만 달러로 만들어주었다.&lt;/p&gt;
&lt;p&gt;내가 이 이야기를 읽었을 때, 상당히 감명 깊게 읽으면서 6센트면 대량 소비시장을 뚫을 수 있다고 결정할 수 있었던 논리가 궁금해지기도 했다.
정량적인 수치를 목표로 잡을 때 항상 왜 그 정도를 목표로 잡는 것이 합리적인지 결론을 짓는 것이 어려운 일인 것 같다.
관련한 부분을 좀 더 조사하고 공부해야겠다.&lt;/p&gt;
&lt;p&gt;이 책에서는 틈새시장은 쓸모 없다고 말한다.
그 이유는 일단 대량 소비시장의 성장을 활용할 기회를 얻을 수 없으며, 대량 소비시장을 겨냥하여 개발된 새로운 기술이 기존 기술을 무용지물로 만들어버리기 때문이다.
즉, 대량 소비시장을 겨냥한 기업이 기존의 틈새시장까지도 다 집어 삼킬수 있다는 말이다.&lt;/p&gt;
&lt;p&gt;대량 소비시장의 욕구를 충족시키기 위해서는 낮은 가격이 중요하다. 이전에 나와있던 다른 제품에 비해 파격적으로 낮은 가격에 제품을 제공해야 한다.&lt;/p&gt;
&lt;p&gt;낮은 가격을 목표로 할 때, 경영진들은 먼저 그 가격에 맞추어 제품을 제작할 수 있는 기술을 찾아내고 개발해야 한다.
이에 따라 생산 시스템이 움직이기 때문에 대량 소비시장에 대한 비전이 생산 시스템을 움직이는 거라 할 수 있다.&lt;/p&gt;
&lt;p&gt;또한 낮은 가격을 목표로 하는 것은 새로운 시장 진출자에게는 아주 중요한 문제이다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;품질이 좋고 가격도 비싼 기술 vs 품질은 다소 떨어질 망정 낮은 가격을 책절할 수 있는 기술&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;많은 기업들이 틈새시장을 노리면서 전자를 선택하지만, 이 책에서는 후자를 선택한 기업들이 빠른 성공을 거두었다고 이야기하고 있다.&lt;/p&gt;
&lt;p&gt;회사가 일단 대량 소비시장을 목표로 제품을 팔고자 한다면, 운영 규모는 여러 가지 요인에 의해 상당히 커진다.
그리고 이런 막대한 운영 규모로 인해 회사는 원료 구입 및 제품 제작, 마케팅에서도 큰 경제적 이득을 누리며 큰 수익을 올리게 된다.
그리고 이렇게 증대된 이익은 신제품의 품질 향상과 가격 인하를 목표로 다시 제품 연구를 지원하게 한다.
이런 과정은 대량 소비시장의 범위를 더욱 확대하면서도 회사와 소비자에게도 모두 이로운 사이클을 형성하게 된다.&lt;/p&gt;
&lt;h1&gt;5장&lt;/h1&gt;
&lt;p&gt;그래서 과연 비전이란 무엇일까?&lt;/p&gt;
&lt;p&gt;비전의 중요한 요소 중 하나는 &lt;strong&gt;대량 소비시장&lt;/strong&gt;의 욕구에 중점을 둔다는 것이다. (앞 장에서 이야기 했다.)
여기에 더해서 비전에는 대량 소비시장을 공략할 만한 새로운 아이디어가 포함된다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;맥도날드는 바쁜 사람들을 위해 깨끗한 분위기와 저렴한 가격의 패스트푸드를 선보였다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;질레트는 간편하고 안전하게 면도할 수 있게 일회용 면도날을 선보였다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;패더럴 익스프레스는 긴급 수송을 원하는 소비자에게 빠르고 빋을 만한 배달을 제공했다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이 아이디어들은 가끔 역설적인 특징을 갖는다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;지금 보기에는 너무 단순하고 분명해 보이지만 처음 제시되었을 당시에는 실현 불가능하고 급진적이며 어리석은 생각으로 보였다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이러기 위해서는 비전가들은 동시대인들이 인정하지 않는 독특한 시각을 가지는 것이 필요하다.
(개인적으로 이 부분이 정말 어려운 부분이라고 생각한다.)&lt;/p&gt;
&lt;p&gt;여기에 책에서는 몇 가지 의문점을 던진다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;비전은 새로운 시장과 오래된 시장 모두에 똑같이 적용되는가?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;시장의 나이는 비전과 관계 없다. 사실 활기 없고 겉보기에 완벽하게 갖추어진 시장이라 할지라도 소비자의 욕구를 충족시킬 새로운 방법만
있다면 언제든지 기회는 있다.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;비전은 개인에게 존재하는가 아니면 회사에 존재하는가?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;책에서 조사한 바에 따르면 대부분의 비전은 &lt;strong&gt;개인&lt;/strong&gt;에게 나타난다고 한다. 비전의 특성상 다수가 가질 수 있는 관점이 아니다.
한 회사의 지속적인 성공은 비전을 가진 개인이 리더십을 발휘하게 해주고 그것을 지원해주고 지켜줄만한 능력의 유무에 달려있다.&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;비전의 발전을 방해하는 요인은 무엇인가?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;비전의 발전을 가로막는 공통 요소는 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;자기 만족&lt;/li&gt;
&lt;li&gt;자산 보호&lt;/li&gt;
&lt;li&gt;내부 집중&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이 장에서 이야기 하는 바는 비전이란 &lt;strong&gt;대량 소비시장&lt;/strong&gt;과 그것을 겨냥하는 &lt;strong&gt;아이디어&lt;/strong&gt;로 이루어진 것이라는 것이다.
그리고 그 아이디어는 당대에는 불가능하고 급진적으로 보이지만 실현하고나면 당연해보이는 것이다.&lt;/p&gt;
&lt;p&gt;나머지 장에 대한 이야기는 다음 포스팅에서 다루도록 하겠다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes Nginx Ingress Controller 선택적으로 Auth(인증) 하기]]></title><description><![CDATA[개요 지난 포스팅 에서 kubernetes 에서
nginx ingress controller 를 활용하여 auth…]]></description><link>https://cheong38.github.io/2020-12-28-nginx-ingress-controller-selective-auth/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-12-28-nginx-ingress-controller-selective-auth/index/</guid><pubDate>Mon, 28 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;/2020-12-19-nginx-ingress-controller-auth/index/&quot;&gt;지난 포스팅&lt;/a&gt; 에서 kubernetes 에서
nginx ingress controller 를 활용하여 auth 를 진행하는 법을 살펴보았다.&lt;/p&gt;
&lt;p&gt;실제 서비스를 개발하다보면, 모든 경로에 대해서 인증을 진행해야 하는 것이 아니라 일부 경로는 인증을 해야 하고, 일부 경로는 인증을 하지 않아야 하는 경우가 생긴다.&lt;/p&gt;
&lt;p&gt;본 포스팅에서는 nginx ingress controller 에서 선택적으로 인증을 하는 방법에 대해 살펴본다.&lt;/p&gt;
&lt;h1&gt;구현하기&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# auth-ingress.yaml&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# Some metadata&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//auth.default.svc.cluster.local/auth/authz
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; POST
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-response-headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;role&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;id
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /main
            &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prefix
            &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main
              &lt;span class=&quot;token key atrule&quot;&gt;servicePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# other services specs&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 ingress 에 정의된 spec 의 경로들은 모두 해당하는 서비스에 요청하기 전에 &lt;code class=&quot;language-text&quot;&gt;http://auth.default.svc.cluster.local/auth/authz&lt;/code&gt;
에 요청을 보내 인증을 진행하고, 인증이 올바르게 된 경우에는 타겟 서비스에 요청이 전달되게 된다.
자세한 내용은 &lt;a href=&quot;/2020-12-19-nginx-ingress-controller-auth/index/&quot;&gt;지난 포스팅&lt;/a&gt;을 참고하자.&lt;/p&gt;
&lt;p&gt;이 때, &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; 이라는 서비스가 존재하고 이 중, 다른 경로에 대해서는 인증을 진행해야 하지만,
&lt;code class=&quot;language-text&quot;&gt;/main/products&lt;/code&gt; 경로에 대해 인증을 하지 않아야 하는 경우를 가정해보자.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;auth-snippet&lt;/code&gt; 이라는 어노테이션을 통해 위의 문제를 해결할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# auth-ingress.yaml&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# Some metadata&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//auth.default.svc.cluster.local/auth/authz
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; POST
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-response-headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;role&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;id
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-snippet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
      if ( $request_uri ~ &quot;/main/products&quot; ) {
        return 200;
      }&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /main
            &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; prefix
            &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main
              &lt;span class=&quot;token key atrule&quot;&gt;servicePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# other services specs&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;nginx.ingress.kubernetes.io/auth-snippet&lt;/code&gt; 가 선언된 부분을 보자.&lt;/p&gt;
&lt;p&gt;요청 URI 가 &lt;code class=&quot;language-text&quot;&gt;/main/products&lt;/code&gt; 이면 바로 200 코드를 리턴하고 있다.&lt;/p&gt;
&lt;p&gt;이로써, &lt;code class=&quot;language-text&quot;&gt;/main/products&lt;/code&gt; 경로로 요청이 들어오면,
&lt;code class=&quot;language-text&quot;&gt;http://auth.default.svc.cluster.local/auth/authz&lt;/code&gt; 로 인증을 요청하는 것이 아니라 바로 200 상태코드를 리턴하게 되고,
인증이 성공된 것으로 간주되어 타겟 서비스로 요청이 전달되게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;if ( $request_uri ~ &amp;quot;/main/products&amp;quot; ) {
  return 200;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 부분은 nginx 문법을 사용한다. 특정 path 로 시작하는 것, 끝나는 것, 그 외 nginx 설정에서 지원하는 방법을 지원하니,
다양한 방법으로 다양한 경로에 대한 설정을 할 수 있을 것이다.
(&lt;a href=&quot;https://www.programmersought.com/article/99462844690/&quot;&gt;이 아티클&lt;/a&gt;에도 잘 나와있다.)&lt;/p&gt;
&lt;p&gt;다만, 추후 유지보수를 위해 주석을 필히 같이 남겨주는 것이 좋을 것 같다.&lt;/p&gt;
&lt;h1&gt;마무리&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;/2020-12-17-nginx-ingress-controller/index/&quot;&gt;nginx ingress controller 에 대한 사용법&lt;/a&gt;
그리고 &lt;a href=&quot;/2020-12-19-nginx-ingress-controller-auth/index/&quot;&gt;nginx ingress controller 를 통해 auth 서비스를 설정하는 법&lt;/a&gt;,
오늘은 선택적으로 인증을 진행하는 법에 대해 다루었다.&lt;/p&gt;
&lt;p&gt;이 정도면, 일반적인 케이스의 서비스를 개발하는데는 무리가 없을 것이라 생각된다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes Nginx Ingress Controller Auth(인증) 사용하기]]></title><description><![CDATA[nginx ingress controller…]]></description><link>https://cheong38.github.io/2020-12-19-nginx-ingress-controller-auth/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-12-19-nginx-ingress-controller-auth/index/</guid><pubDate>Sat, 19 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;nginx ingress controller 에 대한 설명 및 설정은 &lt;a href=&quot;/2020-12-17-nginx-ingress-controller/index/&quot;&gt;지난 포스팅&lt;/a&gt; 을 참고하자.&lt;/p&gt;
&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;서비스를 개발하다보면 회원가입, 로그인 그리고 토큰 관리 등 인증 로직을 필요로 하게 된다.&lt;/p&gt;
&lt;p&gt;그리고 이는 시스템 대부분에 걸쳐 활용된다.&lt;/p&gt;
&lt;p&gt;모놀로식 서비스에서는 인증 로직을 하나의 모듈로 구현하고, 이를 다른 모듈에서 가져다 사용하는 방법으로 인증 로직을 공유할 수 있다.&lt;/p&gt;
&lt;p&gt;마이크로서비스에서는 서브 도메인마다 서비스를 따로 배포하다보니, 모놀로식 서비스에서와는 다른 방식이 필요하다.&lt;/p&gt;
&lt;p&gt;일반적으로 아래와 같은 2가지 방법을 생각해볼 수 있다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;인증을 필요로 하는 부분은 인증 서비스에 위임하여 처리한다.&lt;/li&gt;
&lt;li&gt;인증 로직을 구현한 모듈을 라이브러리화 하여 다른 서비스 배포 시 같이 빌드하여 배포한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;본 포스팅에서는 nginx ingress controller 를 활용하여 &lt;strong&gt;1번의 방법&lt;/strong&gt;에 대해 알아보려고 한다.&lt;/p&gt;
&lt;h1&gt;간단한 구조&lt;/h1&gt;
&lt;p&gt;인증 로직을 인증 서비스로 위임했으니 다른 서비스에서 인증 로직을 필요로 하게 되는 경우, 다른 서비스는 인증 서비스를 호출해야 할 것이다.&lt;/p&gt;
&lt;p&gt;예를 들어 User ID 와 Role 정보를 담고 있는 JWT 를 인증 토큰으로 사용하는 경우, 다른 서비스는 요청이 들어온 경우 JWT 를 인증 서비스로
전달하여 JWT 를 검증하고 User ID 와 Role 을 받아오도록 해야 할 것이다.&lt;/p&gt;
&lt;p&gt;이를 도식화하면 아래와 같이 그려질 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 867px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/35e9bf8e7496eb6f3f3d21359543b48f/0f9e1/simple_auth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 42.8%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAA10lEQVQoz6WRyQqEQBBD+/8/TPAnVPAgenDftx5eQcRhnLlMQajqSncS1C3L4ud5/grx9HVdrQt3XnD+oc7zNGim9n2/RO/8cRxvbx0XhmHwZVn6oiisT9Pkx3G0Gde+723O89zQtq3tq6q6EsrE8bCuaxPVjEmapj4IAttjoCRKmmWZD8PQ3mzbdvEmiCMpSIggArhzpndd98YrPWmbprkSmiDKHHCGwI1ipkiob8WOe0/fXN3psoTVSRNFkaW77zUDxDULj3/5n3JJkliSOI4/APe0/4UXVly5b31cJvAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Simple Auth&quot;
        title=&quot;Simple Auth&quot;
        src=&quot;/static/35e9bf8e7496eb6f3f3d21359543b48f/0f9e1/simple_auth.png&quot;
        srcset=&quot;/static/35e9bf8e7496eb6f3f3d21359543b48f/0eb09/simple_auth.png 500w,
/static/35e9bf8e7496eb6f3f3d21359543b48f/0f9e1/simple_auth.png 867w&quot;
        sizes=&quot;(max-width: 867px) 100vw, 867px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;알기 쉽고 특별히 어려운 과정도 아니다.&lt;/p&gt;
&lt;p&gt;그러나 여기서 발생하는 문제는 다른 서비스들이 늘어나게 될 때 생긴다.&lt;/p&gt;
&lt;p&gt;아래 그림을 보자.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 881px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/53b6c57f2830f7ff1abdf54586f4b56e/6fa0c/multi_service_simple_auth.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 79.6%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQ4y42T3YrCMBCFff+nkxVU8EIUvFBQbLVWbdLZfNNMTLNFdiAm5kzOnPnprK5reb1e8nw+JxfYN9zW+/2WqqpkhvM3c86p838M4hk/WN/30nXdSBVE1+tVLpeLnnMsV05Q7PF4fAgtgvdeydmx8/ksx+NRz4YZzk4gy2CSEKcy5fIuN7IywrZthxra5f1+TwVGAXvTNOqIn6k2teBgKIMDXyVEBX+Wy6XcbrcUgPv9fi+73S4RWspg+IFvt1txAUNQUng4HGSxWMjpdBK7g3y1Wslms9HmlDVkTNbrtS7GLykEVGdGJKRgdesC1oOhmHNWS8VDFoa7cP7TFADffWau904fEEgimSkc8AHzEdem5HOohNkQE9Xrg6AgYKUR0CdCXxCikEYwi8xWANtQE+pCsduQDgEkKlQBbsjA+ymFljJ14YsJJDj/hEbN5/Oh8+GBBkV5XFbDyZRzo0lgqGuiUtK2mqWlde8+g50T5kuy4k8FHNUy7pMKy330sAg6EhAJfwGl1uhVxnObqgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Mutiple Services Simple Auth&quot;
        title=&quot;Mutiple Services Simple Auth&quot;
        src=&quot;/static/53b6c57f2830f7ff1abdf54586f4b56e/6fa0c/multi_service_simple_auth.png&quot;
        srcset=&quot;/static/53b6c57f2830f7ff1abdf54586f4b56e/0eb09/multi_service_simple_auth.png 500w,
/static/53b6c57f2830f7ff1abdf54586f4b56e/6fa0c/multi_service_simple_auth.png 881w&quot;
        sizes=&quot;(max-width: 881px) 100vw, 881px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;서비스가 많이 늘어나고 각 서비스들이 인증 로직을 필요로 한다면, 인증을 필요로 하는 모든 서비스가 각각 Auth Service 를 호출해야 할 것이다.&lt;/p&gt;
&lt;p&gt;그 서비스를 또 각기 다른 팀에서 개발한다면, 팀마다 각기 다른 방식의 인증 호출 로직 코드가 들어갈 것이다.&lt;/p&gt;
&lt;p&gt;이는 장기적으로 볼 때 전체 서비스에 대한 유지보수성을 떨어뜨릴 수 있다.&lt;/p&gt;
&lt;p&gt;이를 해결하기 위해 Nginx Ingress Controller 의 auth 기능을 이용할 수 있다.&lt;/p&gt;
&lt;h1&gt;더 나은 구조&lt;/h1&gt;
&lt;p&gt;Kubernetes 에서 nginx ingress controller 를 이용하면 서비스로 요청을 보내기 전에 Auth Service 에서 인증을 거친 후,
인증 실패 시, 다른 서비스로 요청을 보내지 않고 바로 User 에 에러 응답을 내려주고, 인증 성공 시 인증 데이터를 주입(inject) 하여,
다른 서비스로 요청을 보낼 수 있다.&lt;/p&gt;
&lt;p&gt;이 구조를 그림으로 나타내면 아래와 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1011px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9885b61e8464142b4630b4a10b956c70/0d97d/better_arch.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 36.6%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA3ElEQVQoz3WRyYrFUAhE8/9flQ/ILlllHQgZyDxP1RzBB3ndLYji1bLKG0zTpOM4fvm+79q2TU3TqCgK0TfPs8VxHC1f19V6ied5CgsoYPd9W5H4PI/cruuyYcBZ0ratkiSxnDfv+QDywMAwDMam73vbmKapqqqSvwNUlqXyPFdd11qW5QMI2IshEgDsus4c0DAMFcexSQSMSN0Hv1W8GFIAmK2wc3nknICchc4ecGp+rhdDT/4zAAHA6UVyFEUGzCkgAQGXH/gvs/EvR26WZXY/zgFTPxFgrsSJ/QDW9x98th8F7gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Better Architecture&quot;
        title=&quot;Better Architecture&quot;
        src=&quot;/static/9885b61e8464142b4630b4a10b956c70/0d97d/better_arch.png&quot;
        srcset=&quot;/static/9885b61e8464142b4630b4a10b956c70/0eb09/better_arch.png 500w,
/static/9885b61e8464142b4630b4a10b956c70/1263b/better_arch.png 1000w,
/static/9885b61e8464142b4630b4a10b956c70/0d97d/better_arch.png 1011w&quot;
        sizes=&quot;(max-width: 1011px) 100vw, 1011px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;실제 구현&lt;/h2&gt;
&lt;p&gt;구현에 앞서 Nginx Ingress Controller 가 설정되어 있어야 한다. Minkube 에 Nginx Ingress Controller 를 설정하는 법은
&lt;a href=&quot;/2020-12-17-nginx-ingress-controller/index/&quot;&gt;이전 포스팅&lt;/a&gt;을 참고 바란다.&lt;/p&gt;
&lt;h3&gt;Ingress&lt;/h3&gt;
&lt;p&gt;Ingress 에 다음과 같은 annotation 을 추가해준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ingress.yaml&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# Some metadata&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//auth.default.svc.cluster.local/auth/authz
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; POST
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/auth-response-headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;role&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;id
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Define rules&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt; namespace 에 auth 라는 이름으로 서비스가 정의되어 있고, 해당 서비스는 &lt;code class=&quot;language-text&quot;&gt;POST /authz&lt;/code&gt; 경로로 요청을 받는다.
이 경로에서 JWT 를 검증하고 올바르지 않으면 에러를, 올바르면 성공을 응답할 것이다.&lt;/p&gt;
&lt;p&gt;추가로 &lt;code class=&quot;language-text&quot;&gt;x-auth-role&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;x-auth-id&lt;/code&gt; 를 auth 응답 헤더르 지정하여 인증된 사용자의 역할과 ID 를 다른 서비스에서 해당 이름의
헤더로 받아볼 수 있게 하였다. 이 필드는 필요에 따라 추가, 수정하거나 삭제할 수 있다.&lt;/p&gt;
&lt;p&gt;annotation 에 대한 자세한 설명과 추가적인 필드는 &lt;a href=&quot;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#external-authentication&quot;&gt;공식 문서&lt;/a&gt;를 참조한다.&lt;/p&gt;
&lt;h3&gt;Auth Service&lt;/h3&gt;
&lt;p&gt;Auth 서비스를 전부를 이 포스팅에서 구현하긴 분량이 너무 많을 듯 하고 필요한 부분인 authz 경로의 로직을 살펴보자.&lt;/p&gt;
&lt;p&gt;먼저 JWT 의 구조를 가정해보자. JWT 의 payload 는 다음과 같이 구성되어 있다고 가정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;string&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;role&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;string&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; 는 인증된 사용자의 ID 를 의미하고, &lt;code class=&quot;language-text&quot;&gt;role&lt;/code&gt; 은 인증된 사용자의 역할을 의미한다. 서비스에 따라 역할을 복수가 될 수도 있을 것이고,
다른 데이터가 필요하다면 추가할 수도 있을 것이다.&lt;/p&gt;
&lt;p&gt;다음으로 authz 의 구현을 단순화하여 살펴보자.
nodejs 와 express 로 구현하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/authz&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; authorization &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;authorization&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// authorization = `Bearer &amp;lt;jwt-token&gt;` 과 같이 전달될텐데,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// extractJwt 함수에서는 &amp;lt;jwt-token&gt; 부분을 추출한다.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; jwt &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;extractJwt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authorization&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 일반적으로 라이브러리를 이용하여 verify 가 구현될 것이다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; payload &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;jwt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    res
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x-auth-role&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;role&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x-auth-id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;statue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 여기서는 토큰이 인증되지 못한 경우 401 (Unauthorized) 를 응답하도록 하였다.&lt;/span&gt;
    res
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Auth Service 를 위한 ingress 정의&lt;/h3&gt;
&lt;p&gt;auth 서비스는 다른 ingress 로 정의해주어야 한다. 위의 &lt;code class=&quot;language-text&quot;&gt;ingress.yaml&lt;/code&gt; 에 같이 정의하게 되면, auth 도 인증 로직을 거치게 되어,
authz 를 호출할 때도 &lt;code class=&quot;language-text&quot;&gt;authorization&lt;/code&gt; 헤더를 요청하게 되는 문제가 발생할 것이다.&lt;/p&gt;
&lt;p&gt;아래와 같이 새로운 ingress 를 정의하여 kubernetes cluster 에 추가해주자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ingress-no-auth.yaml&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;no&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /auth
            &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
            &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auth
              &lt;span class=&quot;token key atrule&quot;&gt;servicePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;다른 서비스에서 인증 데이터 사용하기&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ingress.yaml&lt;/code&gt; 에 다른 서비스로의 경로를 지정해주면 해당 서비스를 호출하기 전에 auth 의 &lt;code class=&quot;language-text&quot;&gt;authz&lt;/code&gt; 를 수행하여 인증 데이터를 주입받는다.&lt;/p&gt;
&lt;p&gt;nodejs 와 express 로 간단히 코드를 살펴보면 아래와 같을 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/something&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; role &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x-auth-role&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;x-auth-id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Do something with `role` and `userId`&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;마무리&lt;/h1&gt;
&lt;p&gt;Nginx Ingress Controller 를 이용하여 마이크로서비스 인증 로직을 하나의 서비스에서 처리하고, 다른 서비스에서는 인증 로직에 대해
신경을 쓰지 않을 수 있도록 하는 구조에 대해 알아봤다. 이를 이용하면, &lt;strong&gt;서비스마다 관심사&lt;/strong&gt;를 분리하는데 보다 도움이 될 수 있을 것이다.&lt;/p&gt;
&lt;p&gt;실제 프로젝트를 진행하다보면, 특정 경로로 들어오는 경우에는 인증을 거치지 않아야 하는 것이 필요할 수 있다.
이 때는 특정 경로에 대해서는 인증 로직을 수행하지 않도록 예외처리가 필요하다.&lt;/p&gt;
&lt;p&gt;이 부분에 대해서는 다음 포스팅에서 알아보도록 하자.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Intellij 에서 bazel plugin 사용하기]]></title><description><![CDATA[개요 나는 jetbrain 사의 intellij 계열의 IDE 를 주로 사용한다.
유료이긴 하지만 리팩토링 툴이나 의존성을 체크해주는 등의 기능은 그 돈 값을 충분히 한다고 생각한다. bazel…]]></description><link>https://cheong38.github.io/2020-12-18-intellij-bazel/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-12-18-intellij-bazel/index/</guid><pubDate>Fri, 18 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;나는 jetbrain 사의 intellij 계열의 IDE 를 주로 사용한다.
유료이긴 하지만 리팩토링 툴이나 의존성을 체크해주는 등의 기능은 그 돈 값을 충분히 한다고 생각한다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://bazel.build/&quot;&gt;bazel&lt;/a&gt; 은 하나의 소스 저장소를 사용하는 모노레포 프로젝트에 적합한 빌드 도구이다.
심지어 도메인도 &lt;code class=&quot;language-text&quot;&gt;.build&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;intellij 에서도 bazel 파일들을 하이라이트를 보고 싶어!&lt;/h1&gt;
&lt;p&gt;프로젝트에 bazel 을 도입하였고, bazel 을 사용하는 일이 많다.
하지만 기본적으로 intellij 는 bazel 의 문법을 지원하지 않는다. 그렇기에 소스를 편집하거나 보는데 불편함이 있다.&lt;/p&gt;
&lt;p&gt;누군가 플러그인을 만들어놓지 않았을까? 내가 생각한 무언가는 이미 존재하고 있을 확률이 크다.
그래서 플러그인을 검색해보았다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 983px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a99ed3ab2b81567b4b0fe9c6a67c2e82/536b4/intellij_market.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABqElEQVQ4y6WUyW7bMBCG9VTxJtmxtZK0LMnabFfyFjhoUcBAD0VvySFAcssr/xkylRwZslskhw9Dzoi/hsMhtWgWwJwJ2C7BprA9Ae4HsFyGseUoHCbgRzH4LIQnfJpzFZ/YropP7HfkWJslJZLlHeLlDmFawhExiXMVHAxvoY/GGBgjGBMHt46AMTZhkE/5Kd6AvtN4uEK6OSIr7jGlsemG6PZ1Rac3ONHtK27+ouYf44T0azxYYLU+IMrWcKcZZZjUYpXwCaPFpzcS0FiwxGrzHdLaoil4TmvmH2JKkPsxivUdongBl4VUP78O9gYG+vqwkXFlZR0rdKpdJazN94+Y7x8win5hkv7GOPxZL1SHQQvaSiB/VtHY8vzwguL4CrZ5hvXtCVb+R9Xq01tO0hW2+wOKcotyvQMTQeuBnAu2xZRglG2xKKllogLONIfF4quL/ikoW8Xzc9UyEpvNvyboiBQVUtC6IPg/1BmeyJVgp3e98BeRN0U28omUBKNGS1yjW1vZRkM115h8WTxOd5jX1qSX5CqOp2ySLxHEKZKMziDdwcx+4A2ZVxJccGVx2wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Bazel in intellij marketplace&quot;
        title=&quot;Bazel in intellij marketplace&quot;
        src=&quot;/static/a99ed3ab2b81567b4b0fe9c6a67c2e82/536b4/intellij_market.png&quot;
        srcset=&quot;/static/a99ed3ab2b81567b4b0fe9c6a67c2e82/0eb09/intellij_market.png 500w,
/static/a99ed3ab2b81567b4b0fe9c6a67c2e82/536b4/intellij_market.png 983w&quot;
        sizes=&quot;(max-width: 983px) 100vw, 983px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;!?&lt;/p&gt;
&lt;p&gt;“없네…? 인터넷에서도 한 번 검색해보자.”&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://plugins.jetbrains.com/&quot;&gt;intellij marketplace 웹사이트&lt;/a&gt; 에서 bazel 을 검색해보았다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1407px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0b076749b7671ff8f1ad4a1895a46fc3/5e281/search_bazel_in_website.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACL0lEQVQ4y4VT2Y7TQBD0/7C75JACCPECD3w4iKdVLhLt4wokO77t+IyPuOhqJ94krLQjlbqn3FPTx9i4ux9jOp1hNBrj67fv+PjpC97djXD/MBnAGHK0l9xEzs0+fFaMJzM8vJ/CWCxWeHycK7bbJ6zXG8znS5An6K/XW/22Wv0evs3nKyyXa+WIhfhz4Y0o2iOOBVGCIIgQhvEA7vf7FJvNE378/IXn5z+6D4L4Ki4iRIcwbNvFJRzHQ+AHKhYEoQRHsExLxWzbEYGeDwWMY/zlecN1fSUJ+ubOg+mIUBQr3CCFH+XI8wJpmkmGCbwwhSO848dyzod7Ok/fOAv5cpvn+bBsH39NF5ZlY7dzYPECyxX/JQtyO4mjVUG3B7VUkOW5foTi0KCpa7Rti1pskqQoikL3TdOjruq+bOl53TQSJ2fEHg6ViqpgJEMJ0xpx3uJ4PIKLloJZlqlPUS7afZLDTxqUIgJ0A6+Ctu3JlBO0TS3ZVVcHsyzX26uqkgwO6LpOsyTPeFZB7kbQ1UZznb4NARzE7aJgUZT/8W17fCmZb4kZMJNKelSWB82CF9Evy/Jke57vlq3I81zF2We+gCtBU0o3ZZJ8Y+wZS2UPPc/TA8djp1mQv3xqtzAcKZk95FDCpNQsVfDUQ4qduTM8Lxje7S1OQ9lL+pkiTVMtkZmwLPp9KyodArN8Q7AfCqfVXUyFmbw2lDczPD9s9ouNZZnMjJfw17vkabk/9/A1wX+PtJTNeytJFgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Search bazel in website&quot;
        title=&quot;Search bazel in website&quot;
        src=&quot;/static/0b076749b7671ff8f1ad4a1895a46fc3/5e281/search_bazel_in_website.png&quot;
        srcset=&quot;/static/0b076749b7671ff8f1ad4a1895a46fc3/0eb09/search_bazel_in_website.png 500w,
/static/0b076749b7671ff8f1ad4a1895a46fc3/1263b/search_bazel_in_website.png 1000w,
/static/0b076749b7671ff8f1ad4a1895a46fc3/5e281/search_bazel_in_website.png 1407w&quot;
        sizes=&quot;(max-width: 1407px) 100vw, 1407px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;“뭐야? 있는데…?”&lt;/p&gt;
&lt;p&gt;CLion 용은 아닌거 같고 Android Studio 도 아니고, 세 번째인 것 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1309px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/30a0dfa602d8518efadfedfeb8819654/3d556/bazel_detail_in_website.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 78.2%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAABM0lEQVQ4y51TW26EMAzM/dUbtf3qXy9Q9QQL3RKS8Ah5urYp0S5CsIulgQjiyXjsiLqqIKUEFDnn8l7W61h/95j6VQPUhv+CeP/4BK31HdEeKEIIME0OUvDwox28vHl4/Z7/iYiPGCNjUXoUREx7eX+mnMTq6DxhbALvHTjn8NTpIZVrhJghpnktrJ2YyHu/qeRZCKU0tK0Ehei6rpSybtS+BTPYwx5JtBmgMRMM41hKJ+MfJST/ioecHBN6cL5cyk35f2wul4o7fMYzIiBrpLFgBjeXTDPofSglPhusMAYknkWJpmmg73vG0nHyEfJB6Rv+cpelbJlkxIYQQrgf8KMruL5F4nr9xbFpQUocHaVQpT28z3shiISGmsokH2/n7wypUNgUIltwO3+nFG7lnCFa4g9DTPDK16/zmgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Bazel detail in website&quot;
        title=&quot;Bazel detail in website&quot;
        src=&quot;/static/30a0dfa602d8518efadfedfeb8819654/3d556/bazel_detail_in_website.png&quot;
        srcset=&quot;/static/30a0dfa602d8518efadfedfeb8819654/0eb09/bazel_detail_in_website.png 500w,
/static/30a0dfa602d8518efadfedfeb8819654/1263b/bazel_detail_in_website.png 1000w,
/static/30a0dfa602d8518efadfedfeb8819654/3d556/bazel_detail_in_website.png 1309w&quot;
        sizes=&quot;(max-width: 1309px) 100vw, 1309px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;“오 심지어 Google 에서 직접 만든거야!?”&lt;/p&gt;
&lt;p&gt;“최근 릴리즈 일자도 2020.12.01. 나름 최신이군.”&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1276px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0902abb3bdc586326f5ceb76f3e035d9/5fbd7/bazel_versions_in_website.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.4%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABa0lEQVQ4y42UQXKDMAxFuf+mN2pXXXS6yaqbHiC0DUnAxMaW7V8pRNSFMEEzGgcsnr/l71Tvuw+8vu3Q9z0kcs4PUyKEgGHwSOSxP3k8PQe8fGZUITKECyhmxBiRUsKWELDUjvWaYGDwIIo4D7wqJcjzFpXzvApKrLBpjtjXNer6i7O+qix0TGrm6tayatsWh0MDGY/HE/dl4HQYuBc2ZAReGbdimZMFy17Oo3LWgnibGkSE3hhYH2H4tac/oOXacgcK/a/QWJyNm5qsRTESIgVOGucYJItJjff++ruETQpbBzQX3GBpOjmxhSiSVJtIW0ShjPp+CbQJBzNCckqFFTBBtRWGWyHArjNwzt0Hdi7fBUqRbE0/LIEyrgJbBn53abFlBZYKu67bALQZP6wwFgr1ROU6yofyHGncqvbwclnpofhsYGukufNZkZ6mOkBPOQSa7LMAYnEvCj+yQjXy2n1eGPvRv8qW+TJ+Acvcngox5m9dAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Bazel versions in website&quot;
        title=&quot;Bazel versions in website&quot;
        src=&quot;/static/0902abb3bdc586326f5ceb76f3e035d9/5fbd7/bazel_versions_in_website.png&quot;
        srcset=&quot;/static/0902abb3bdc586326f5ceb76f3e035d9/0eb09/bazel_versions_in_website.png 500w,
/static/0902abb3bdc586326f5ceb76f3e035d9/1263b/bazel_versions_in_website.png 1000w,
/static/0902abb3bdc586326f5ceb76f3e035d9/5fbd7/bazel_versions_in_website.png 1276w&quot;
        sizes=&quot;(max-width: 1276px) 100vw, 1276px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;호환성을 보니 최신 버전은 intellij 2020.2.4 까지 지원한다.
현재 intellij 버전을 살펴보자.&lt;/p&gt;
&lt;p&gt;현재 최신 버전의 intellij 는 2020.3 이다.&lt;/p&gt;
&lt;p&gt;“오잉!?”&lt;/p&gt;
&lt;p&gt;2020.3 은 지원이 안되네…&lt;/p&gt;
&lt;p&gt;실제로 다운로드하여 적용해보면,&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 982px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.2%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAC2UlEQVQ4y12U2Y7bRhRE9T22Y1jWQlHcmvtOipRIShRHGjtxgBhG4MAf4NcESPKSDy5X98zI4zwUWqTI03Xr3ubMEgG2lgvD8WDYHixBbS3Yuo311oSmG9hwXWobSlfXumlhtdne/tPk77WONZ+ZjdM9juMdDv2IrNjBiRKc4xShf0F5/Yjr9YrhfIfx7oruOCJKcyR5iarZww0iGKYDe5fCu2+x2uqY9b98hWg/w9t/gd9+QjFdECUlzLRD3nbcbEJ/OmPg2vQnhEWDIE6oFJafQadD3RPQYhfz5Qqz6Y//kP/8N8LLn4inr8gvvyJMawRRBC+KIehChDHdhHCyPbz+I+wgJ4ilGzZlYaObWK90LCTw3fsPmFjO5XKPLKth/KYhqENEUQ6PMI0OVo4JQwjEWYX6cELZdCjKCmW9oxol4QWYL5aYDdMHFM2EMO8RpC3seoIbZYSFDN1UoVu2C8txUfHF03jGrmnR7A9KZbVjRBkc138ARkWPWGlgqS26y2c6qeETKGFSW8fhFAiEzO1IYE2gdCXXrKjUfZvT8XbBkuNHYESHcd7h33/+wnA8qh1l4LLktWMpqIxgYKcP/YCuPypJl7t2jyQrMH+7eABGBMlVOhReol6UuxqWQ6AB7REYsDkS2Ow77A8dGoL2XY+W1/L5m8PnwMBq4Pkxu5xga9o3oCzZ9UMMpxHjecJpuuIwjOiHE+E9HeZ49frN/4AZwxa/I+BYhJy1rfEjUG5S7Tg6dGp5MTsfqrF50ssXr9gUwp47XJY53DBBxBKkI9kUmx22bTqMK3jNe+gixXojj+HD8Xs6govX8yeH37vs8fj5dBJStwxtG6ZwYcrxEf6t+0/SHtf5m+WPDoO0QVofVMCyATJD9YJtKaDsvPB8Vd762cdhI1e6/eklMwzTAkGSK/kcUHnEBEuVR84lVOblBRQdy2t1n2rZ3ao9cKi5ecm4zl8w10x8A00iJOx5ZK9XAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Version is not compatible&quot;
        title=&quot;Version is not compatible&quot;
        src=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png&quot;
        srcset=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/0eb09/version_not_compatible.png 500w,
/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png 982w&quot;
        sizes=&quot;(max-width: 982px) 100vw, 982px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;대략적으로 내부적으로 intellij 의 빌드버전은 203 인데, 내가 다운로드한 플러그인은 202 혹은 그보다 오래된 버전을 요구한다고 한다.&lt;/p&gt;
&lt;p&gt;아니 보통 특정 버전이거나 그 보다 최신 버전이어야 한다고 하지 않나..? 얘는 왜..&lt;/p&gt;
&lt;p&gt;그렇게 뭔가 좋은 방법이 없나 찾아보던 중, bazel 플러그인의 &lt;a href=&quot;https://github.com/bazelbuild/intellij&quot;&gt;github 저장소&lt;/a&gt; 를 발견하였다.&lt;/p&gt;
&lt;p&gt;오늘자 기준으로 마지막 커밋이 이틀 전! 활발하게 업데이트되고 있는 저장소이다.
최신 소스를 받아서 빌드하면 현재 버전의 intellij 도 지원되지 않을까?
심지어 친절하게 README 에 빌드 방법 및 빌드된 파일이 나오는 장소까지 알려주고 있다.&lt;/p&gt;
&lt;p&gt;자, 이제 다 됐다. 빌드하러 가자.&lt;/p&gt;
&lt;h1&gt;플러그인을 빌드하고…&lt;/h1&gt;
&lt;p&gt;우선 소스를 다운로드 받자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/bazelbuild/intellij.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 가이드대로 빌드를 해보자. (단, 이미 bazel 은 설치되어 있어야 한다.)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; intellij
$ bazel build //ijwb:ijwb_bazel_zip --define&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ij_product&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;intellij-latest&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;순조롭게 빌드는 진행됐고, &lt;code class=&quot;language-text&quot;&gt;bazel-bin/ijwb/ijwb_bazel.zip&lt;/code&gt; 파일을 플러그인으로 추가해주면 된다.&lt;/p&gt;
&lt;p&gt;intellij 설정을 열고 plugin 에서 설정을 눌러 Install Plugin from Disk 를 클릭하여 위의 zip 파일을 선택해준다.&lt;/p&gt;
&lt;p&gt;“안되잖아!?”&lt;/p&gt;
&lt;p&gt;아무래도 이상해서 소스에서 2020.3 을 키워드로 검색해보았지만 2020.2 는 검색이 되도 2020.3 으로는 검색이 되지 않는다.
최근까지 커밋은 올라왔지만 아직 2020.3 버전 지원은 안되고 있나보다. (이런게 제일 1순위여야 하는거 아닌가…?)&lt;/p&gt;
&lt;h1&gt;여기서 멈출 수 없다.&lt;/h1&gt;
&lt;p&gt;나는 밋밋한 마치 메모장과 같은 그런 환경에서 코딩을 하는 것은 정말 바보같은 짓이라고 생각한다.
왜 1960년대에나 코딩했을 법한 환경에서 2020년에 코딩해야 한단 말인가…
무엇보다 다른 파일에서 bazel rule 을 붙여넣으면 들여쓰기가 모두 사라져버린다.
생산성도 많이 떨어지게 되고, 무엇보다 &lt;strong&gt;휴먼 에러&lt;/strong&gt;를 발생시킬 확률이 높다.&lt;/p&gt;
&lt;p&gt;그렇기에 여기서 멈출 수 없었다. 누군가 이슈를 등록해두지 않았을까?&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/bazelbuild/intellij/issues&quot;&gt;github 이슈&lt;/a&gt; 에서 한 페이지를 넘기기 전에
&lt;a href=&quot;https://github.com/bazelbuild/intellij/issues/2102&quot;&gt;관련한 이슈&lt;/a&gt; 를 찾아볼 수 있었다.&lt;/p&gt;
&lt;p&gt;답변을 보니 친절하게도 &lt;a href=&quot;https://github.com/bazelbuild/intellij/pull/2246&quot;&gt;PR&lt;/a&gt; 까지 만들어서 올려두었다.
아니! 9일 전에 올라온 PR 인데 왜 그 사이 릴리즈는 하면서 PR 은 안 받아주는것이냔 말이다.&lt;/p&gt;
&lt;h1&gt;그렇다면, 직접 PR 내용을 빌드하겠다.&lt;/h1&gt;
&lt;p&gt;머지않아 공식적으로 2020.3 버전을 지원하겠지만 그래도 지금 당장 불편이 크므로 위의 PR 의 내용을 빌드하여 사용해보기로 했다.&lt;/p&gt;
&lt;p&gt;위에서 다운로드 받은 소스의 루트 디렉토리로 이동한다.
그후 해당 PR 의 소스를 브랜치로 만들어서 다운로드하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; fetch origin pull/2246/head
$ &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; switch -c ijwb-203 FETCH_HEAD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그러면 ijwb-203 브랜치에 PR 의 소스가 다운로드되었을 것이다.
이제 bazel 빌드를 똑같인 해주면 될 것 같다!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ bazel build //ijwb:ijwb_bazel_zip --define&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ij_product&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;intellij-latest&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;이제 끝…?&lt;/h1&gt;
&lt;p&gt;기쁜 마음으로 Install Plugin from Disk 를 클릭하여 zip 파일을 선택하였지만 결과는…&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 982px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.2%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAC2UlEQVQ4y12U2Y7bRhRE9T22Y1jWQlHcmvtOipRIShRHGjtxgBhG4MAf4NcESPKSDy5X98zI4zwUWqTI03Xr3ubMEgG2lgvD8WDYHixBbS3Yuo311oSmG9hwXWobSlfXumlhtdne/tPk77WONZ+ZjdM9juMdDv2IrNjBiRKc4xShf0F5/Yjr9YrhfIfx7oruOCJKcyR5iarZww0iGKYDe5fCu2+x2uqY9b98hWg/w9t/gd9+QjFdECUlzLRD3nbcbEJ/OmPg2vQnhEWDIE6oFJafQadD3RPQYhfz5Qqz6Y//kP/8N8LLn4inr8gvvyJMawRRBC+KIehChDHdhHCyPbz+I+wgJ4ilGzZlYaObWK90LCTw3fsPmFjO5XKPLKth/KYhqENEUQ6PMI0OVo4JQwjEWYX6cELZdCjKCmW9oxol4QWYL5aYDdMHFM2EMO8RpC3seoIbZYSFDN1UoVu2C8txUfHF03jGrmnR7A9KZbVjRBkc138ARkWPWGlgqS26y2c6qeETKGFSW8fhFAiEzO1IYE2gdCXXrKjUfZvT8XbBkuNHYESHcd7h33/+wnA8qh1l4LLktWMpqIxgYKcP/YCuPypJl7t2jyQrMH+7eABGBMlVOhReol6UuxqWQ6AB7REYsDkS2Ow77A8dGoL2XY+W1/L5m8PnwMBq4Pkxu5xga9o3oCzZ9UMMpxHjecJpuuIwjOiHE+E9HeZ49frN/4AZwxa/I+BYhJy1rfEjUG5S7Tg6dGp5MTsfqrF50ssXr9gUwp47XJY53DBBxBKkI9kUmx22bTqMK3jNe+gixXojj+HD8Xs6govX8yeH37vs8fj5dBJStwxtG6ZwYcrxEf6t+0/SHtf5m+WPDoO0QVofVMCyATJD9YJtKaDsvPB8Vd762cdhI1e6/eklMwzTAkGSK/kcUHnEBEuVR84lVOblBRQdy2t1n2rZ3ao9cKi5ecm4zl8w10x8A00iJOx5ZK9XAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Version is not compatible&quot;
        title=&quot;Version is not compatible&quot;
        src=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png&quot;
        srcset=&quot;/static/45f59eb2d8ca0ff3f87a5f51b5497f51/0eb09/version_not_compatible.png 500w,
/static/45f59eb2d8ca0ff3f87a5f51b5497f51/9e029/version_not_compatible.png 982w&quot;
        sizes=&quot;(max-width: 982px) 100vw, 982px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 420px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d64607f28aa76bf777a19c5886ecfc9f/7fbea/dog.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAWABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe5NwaswBYP/xAAZEAADAQEBAAAAAAAAAAAAAAAAARFBAiL/2gAIAQEAAQUC2xG9I9EZHD//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAaEAACAgMAAAAAAAAAAAAAAAABEAARICJB/9oACAEBAAY/AqlnDi2K/8QAHBABAAICAwEAAAAAAAAAAAAAAQAhEBExQWGR/9oACAEBAAE/IVaIsyfTBzm6+jFqK1BUfCFE/9oADAMBAAIAAwAAABCAADz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EB//xAAeEAEAAwACAgMAAAAAAAAAAAABABEhMUFRcWGRsf/aAAgBAQABPxCtCnla6hsJdLShfOTHYhoeAH3Eo911/IHl9IUFPwNcOdQ0jdmeoKC19z//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Dog&quot;
        title=&quot;Dog&quot;
        src=&quot;/static/d64607f28aa76bf777a19c5886ecfc9f/7fbea/dog.jpg&quot;
        srcset=&quot;/static/d64607f28aa76bf777a19c5886ecfc9f/7fbea/dog.jpg 420w&quot;
        sizes=&quot;(max-width: 420px) 100vw, 420px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1&gt;뭐가 문제지?&lt;/h1&gt;
&lt;p&gt;뭐가 문제일까? PR 올린 사람이 사기친건가? 그래서 저장소 소유자가 PR 을 안받아준건가?&lt;/p&gt;
&lt;p&gt;그래도 안되는걸 저렇게 보란듯이 올리진 않지 않을까?&lt;/p&gt;
&lt;p&gt;그래서…!&lt;/p&gt;
&lt;p&gt;소스를 살펴보기로 했다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1219px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dca7f4b800dec946ff8aad5146eac4e2/a7903/source_code.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABP0lEQVQoz42S2W6DMBRE+f9Pq6ouapSlCXsKBoMpgTjBxD51ovYxSh+ORtaM515ZDtQ4UTYK1R1Q/Xij8/SjRp9nzsZyMhdO03+YCYbJoQ2MR80wjL7EoL151WvgeDvPzBbMA66ZwJUCaokuC2QY0aZ72qJGpgVT2+EOww38sIeMRwK7DiHOORaSbJUgthnlZ8rXMkTnAuefA19M8wiFUz3B5Le65HuGsibbxBS7FBHlpOsIGWUYH7Tdt6f71Tso7/e+8MNs2JiIZBS8FiGLOuGjSngptuQnQe0U4tIi7H2qX5W2I3hiyZvdstMlz2LHexvz1sQ8V1tWY05mJXuah+RIShTB2sWE1l/UkvciYVGlrNs9r18Ryyal9lMbvn38Pn++cgeC6/8xs6MfTmRlSy4UVdPftFYDZ+9bB9b+jx+dIa9HgxFOmQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Source code&quot;
        title=&quot;Source code&quot;
        src=&quot;/static/dca7f4b800dec946ff8aad5146eac4e2/a7903/source_code.png&quot;
        srcset=&quot;/static/dca7f4b800dec946ff8aad5146eac4e2/0eb09/source_code.png 500w,
/static/dca7f4b800dec946ff8aad5146eac4e2/1263b/source_code.png 1000w,
/static/dca7f4b800dec946ff8aad5146eac4e2/a7903/source_code.png 1219w&quot;
        sizes=&quot;(max-width: 1219px) 100vw, 1219px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;소스코드를 보던 중 이 부분을 발견했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;intellij-latest&amp;quot;: &amp;quot;intellij-2020.2&amp;quot;,
...
&amp;quot;intellij-beta&amp;quot;: &amp;quot;intellij-2020.3&amp;quot;,
&amp;quot;intellij-canary&amp;quot;: &amp;quot;intellij-2020.3&amp;quot;,
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;여기다!!&lt;/p&gt;
&lt;p&gt;빌드 시 옵션을 &lt;code class=&quot;language-text&quot;&gt;--define=ij_product=intellij-latest&lt;/code&gt; 로 주면, 아무래도 2020.2 버전으로 빌드가 되는 듯 하다.
따라서 &lt;code class=&quot;language-text&quot;&gt;--define=ij_product=intellij-beta&lt;/code&gt; 혹은 &lt;code class=&quot;language-text&quot;&gt;--define=ij_product=intellij-canary&lt;/code&gt; 로 시도해 볼 필요가 있을 것 같다.&lt;/p&gt;
&lt;p&gt;나는 canary 옵션을 주기로 했다(그냥 내 맘). 그리도 ue(ultimate edition 이겠지?) 까지..&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ bazel build //ijwb:ijwb_bazel_zip --define&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ij_product&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;intellij-ue-canary&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;이제 진짜로 끝!&lt;/h1&gt;
&lt;p&gt;intellij 설정을 열고 plugin 에서 설정을 눌러 Install Plugin from Disk 를 클릭하여 위의 zip 파일을 선택해준다.
(몇 번째 하는걸까..?)&lt;/p&gt;
&lt;p&gt;감격의 순간!&lt;/p&gt;
&lt;p&gt;더 이상 에러를 뱉지 않고 순조롭게 플러그인이 설치되었다.
이제 복붙해도 들여쓰기가 사라지지 않는다.&lt;/p&gt;
&lt;p&gt;그리고 무엇보다…&lt;/p&gt;
&lt;p&gt;bazel BUILD 파일에 &lt;strong&gt;색깔&lt;/strong&gt;이 생겼다!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 646px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f8d93116445292077418377e1f0c66e9/3ffe4/bazel_file.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABLElEQVQoz42SaU7DMBCFcyHq8b4lcR0oFVAE97/MY+yUVq1a6I+nsaKZL2+WIeYJ+7cPvH59ox4+sBw+UfZ7TDVjXsYey8vEcUTMkRUwbjNySUhjhjEWxp41+JAwlwofHIwjWC85ieCThQsG1mmE3N4OUkoQUY9SUn9fawiJXcwFc60oy4JSFyilITYCJNYk0eLx/Qs9gy81tJZjTOzAshOPkBwDuehG8i0RtVy6AqbcXUmpsHkSF07kg+ATsLWcx3Ux87byYBW0UXdh//1kCDFDKoX6vENh4O6dN1wmnpu4U0S9zbtAz0BtDIxm9Y3ytq1endBxRkTH+EDLHah1d9fOJ/FMrXP9ZPrpRNtjk7WGty1unsvpbNr8UlqhzvsOM80xF9tr8feW95d+AEvGQsVrQTeOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Highlighted bazel BUILD&quot;
        title=&quot;Highlighted bazel BUILD&quot;
        src=&quot;/static/f8d93116445292077418377e1f0c66e9/3ffe4/bazel_file.png&quot;
        srcset=&quot;/static/f8d93116445292077418377e1f0c66e9/0eb09/bazel_file.png 500w,
/static/f8d93116445292077418377e1f0c66e9/3ffe4/bazel_file.png 646w&quot;
        sizes=&quot;(max-width: 646px) 100vw, 646px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Minikube 로 Nginx Ingress Controller 사용하기 (with AWS ECR)]]></title><description><![CDATA[개요 쿠버네티스 클러스터 외부의 트래픽을 정해진 라우팅 규칙을 통해 내부 서비스로 연결해주는 
쿠버네티스 리소스를 인그레스(ingress) 라고 한다. 인그레스가 작동하려면 인그레스 컨트롤러가 반드시 필요한데 본 포스팅에서는 Nginx Ingress…]]></description><link>https://cheong38.github.io/2020-12-17-nginx-ingress-controller/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-12-17-nginx-ingress-controller/index/</guid><pubDate>Thu, 17 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;쿠버네티스 클러스터 외부의 트래픽을 정해진 라우팅 규칙을 통해 내부 서비스로 연결해주는
쿠버네티스 리소스를 &lt;a href=&quot;https://kubernetes.io/ko/docs/concepts/services-networking/ingress/&quot;&gt;인그레스(ingress)&lt;/a&gt; 라고 한다.&lt;/p&gt;
&lt;p&gt;인그레스가 작동하려면 인그레스 컨트롤러가 반드시 필요한데 본 포스팅에서는 Nginx Ingress Controller 를 사용하는 법을 다루려고 한다.&lt;/p&gt;
&lt;h1&gt;실습&lt;/h1&gt;
&lt;h2&gt;Minikube 설치하기&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://cheong38.github.io/2020-08-27-minikube/index/&quot;&gt;지난 포스팅&lt;/a&gt; 을 참고해 설치힌다.&lt;/p&gt;
&lt;h2&gt;Minikube 시작하기&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ minikube start --vm&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--vm=true&lt;/code&gt; 옵션을 주지 않으면 ingress addon 을 설정하는 과정에서 에러가 발생한다.&lt;/p&gt;
&lt;p&gt;만약 &lt;code class=&quot;language-text&quot;&gt;--vm=true&lt;/code&gt; 옵션으로 실행시 에러가 발생한다면, &lt;a href=&quot;https://www.virtualbox.org/&quot;&gt;VirtualBox&lt;/a&gt; 와 같은
가상머신이 설치되어있는지 확인해보자.&lt;/p&gt;
&lt;h2&gt;ingress addon 설정하기&lt;/h2&gt;
&lt;p&gt;minikube 에서 ingress 를 사용하기 위해서는 addon 을 설정해 주어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ minikube addons &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; ingress&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;AWS ECR 의 이미지 사용할 수 있도록 설정&lt;/h2&gt;
&lt;p&gt;본 포스팅에서는 &lt;a href=&quot;https://aws.amazon.com/ko/ecr/&quot;&gt;AWS ECR&lt;/a&gt; 에 이미지를 올려놓은 경우를 가정하고 있다.&lt;/p&gt;
&lt;p&gt;따라서 ECR 의 이미지를 받아올 수 있도록 Minikube 에 권한 등을 설정해야 한다.&lt;/p&gt;
&lt;p&gt;이 역시 minikube addon 을 통해 설정할 수 있다.&lt;/p&gt;
&lt;p&gt;자세한 설명은 &lt;a href=&quot;https://minikube.sigs.k8s.io/docs/tutorials/configuring_creds_for_aws_ecr/&quot;&gt;여기&lt;/a&gt; 를 참고한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ minikube addons configure registry-creds&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령어 입력 시 아래와 같은 추가 입력을 받을 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Do you want to enable AWS Elastic Container Registry? [y/n]: y
-- Enter AWS Access Key ID: &amp;lt;put_access_key_here&amp;gt;
-- Enter AWS Secret Access Key: &amp;lt;put_secret_access_key_here&amp;gt;
-- (Optional) Enter AWS Session Token:
-- Enter AWS Region: &amp;lt;put_aws_ecr_region&amp;gt;
-- Enter 12 digit AWS Account ID (Comma separated list): &amp;lt;account_number&amp;gt;
-- (Optional) Enter ARN of AWS role to assume:

Do you want to enable Google Container Registry? [y/n]: n

Do you want to enable Docker Registry? [y/n]: n

Do you want to enable Azure Container Registry? [y/n]: n
✅  registry-creds was successfully configured&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리는 ERC 만 설정할 것이므로 &lt;code class=&quot;language-text&quot;&gt;Do you want to enable AWS Elastic Container Registry? [y/n]&lt;/code&gt; 에만 &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt;를 선택하고,
나머지 &lt;code class=&quot;language-text&quot;&gt;Do you want ~&lt;/code&gt; 에는 &lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt; 을 선택한다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;&amp;gt;&lt;/code&gt; 사이의 내용은 적절한 값으로 대체해 넣으면 된다. 빈 칸은 엔터를 치고 넘어가면 된다.&lt;/p&gt;
&lt;h2&gt;Ingress 파일 배포&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; main
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /
            &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
            &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; web
              &lt;span class=&quot;token key atrule&quot;&gt;servicePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /api
            &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
            &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; api
              &lt;span class=&quot;token key atrule&quot;&gt;servicePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 예시와 같은 ingress 파일을 작성하여 배포해보자. 물론 위의 serviceName 과 servicePort 에 맞는 쿠버네티스 리소스가 설정되어 있어야 한다.&lt;/p&gt;
&lt;h2&gt;접속해보기&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ minikube &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 명령어로 나온 IP 주소를 브라우저에 입력해 접속하면 배포한 서비스에 접근할 수 있을 것이다. &lt;/p&gt;</content:encoded></item><item><title><![CDATA[(TIL) Git Merge --no-ff]]></title><description><![CDATA[FF(Fast Forward) git 에서 Fast Forward 현재 브랜치와 Merge 하려는 브랜치가 선형 관계에 있어 Merge 결과 별도의 커밋 없이 커밋을 위에 쌓기만 하는 것을 말한다. 그림으로 살펴보면 아래와 같다.  branch-…]]></description><link>https://cheong38.github.io/2020-09-11-til-git-merge-no-ff/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-09-11-til-git-merge-no-ff/index/</guid><pubDate>Fri, 11 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;FF(Fast Forward)&lt;/h1&gt;
&lt;p&gt;git 에서 Fast Forward 현재 브랜치와 Merge 하려는 브랜치가 선형 관계에 있어 Merge 결과 별도의 커밋 없이 커밋을 위에 쌓기만 하는 것을 말한다.&lt;/p&gt;
&lt;p&gt;그림으로 살펴보면 아래와 같다.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 711px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/805ad481a95e3b716519065db3dd7057/5e9f9/merge-ff.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 80.4%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAABqklEQVQ4y5WUW1ODMBCF+f9/yxd9cOyD1j5oZ7ByEUtLgQRy45hNJeXqjJnJTIDk27MnuwQYjK7r3KRRliV2ux3CMIRSyk0hxHA7jN3bCEMn/fkAC6OH9oNz7mBSSjRNA2OMDSBxOApsI4WCaQd1wKGq4bptW1RV5SCklp5pzRiDcGCOMGvwGiukee2DB9N0e6CUClprv5FgNEcpmw5CdciyzFsTXOWrWdpCNB4wtGAc+PqeApMlLuXeH/JGkQqlIdkZJnmCOb2NAENrphb5lAlIEcgbMloqA346AB930PEjJbZ4UUtgp7BXNzvAv3HJY1zKynu5BJ2OYKkO+4NVzZAkyaKXq8Ap5K/01vYO362WTc043vd7RNHnrFzGFzKGB0st5eqOF6jLsy1oWw7G/NadmflNSy70TSHdMkFdS1nzNRVr+QVE98BxayHagUhlXddu7c7YvUYrxHmLF9t+2UXfgL6lrNJWWHiRooseoLNnq7DxdUqt2JcYKRf2W5RT+2lkxdWW1ZQ7yWyqcuYb9fT00ioukKap+xb89xaXfnWV/XlsNhuczmf8ACVr6lTYfug/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Fast forward example&quot;
        title=&quot;Fast forward example&quot;
        src=&quot;/static/805ad481a95e3b716519065db3dd7057/5e9f9/merge-ff.png&quot;
        srcset=&quot;/static/805ad481a95e3b716519065db3dd7057/0eb09/merge-ff.png 500w,
/static/805ad481a95e3b716519065db3dd7057/5e9f9/merge-ff.png 711w&quot;
        sizes=&quot;(max-width: 711px) 100vw, 711px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;branch-1 로 branch-2 를 merge 하는 상황이며, merge 커밋 없이 branch-1 의 헤더를 branch-2 로 옮겨줄 수 있다.
이런 merge 를 fast forward 라 한다.&lt;/p&gt;
&lt;h1&gt;FF 를 할 수 없는 상황&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 731px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c6cf2a4421b1c7270e317d818f8702c/4bd0f/merge-not-ff.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQ4y41Va4+bMBDk//+qqqeqnyv1caFF6V1OoUmO8AY/sKe7JiaGgHSWVoCzO+tZz24iLJa11j2v1yviOEaapm5PSgmt9cxXaQOhDEdhDLOItgD5yWaMQVmWDqzve2cMXjct4lQi/qcDUAL0gSOQnQB9IAO2bQullNtjYGsN/aaQnDR2R4Gmk9MhovBkd2BA3MAmegQYfvMyhkqhNN4OB5zPZ7cXsdMwDEvmEH3zAMB+YUluR3FM2Bwg0xFCODNmwEAYuj7Bvn2FyRP6to6m9/OBd0bz+kdcF87cNA05C/RCoXvfA4cvUKcfDqzrOlRV5U7M/ssShaWKuDac+WHJEtnlhKIoOXoCe6Q8X6uX4p0bkkaWZcTAbErrAXBLNnyiMGCZzPuGezPZLLPneY4kSVynhCpYY/IhQC8nL50teS1Bo7XChqBsvkv48vh94P1B41Iq7C+kArnZencw1huDMEBd1046LCF+9wn+pB2+vWqcCzm/lLWjC0ESCTqFEyzlJbRFVmkcj6mrOSeMPLWw4GMvEzW7Xqf5bQPvNOryohgBPbXZrLMDdPYbpniZDQc/gWanJJ22z7+4+UfKXBteXBvBhZcaTU5D9eXJ9bPoSmpH4Sjx4p7mGEl7HVn98zvE508Qf/ewvvXuc87ebpbkUh1g6hTmRs8PWD8jnfEEohnQ7RMoek6yWWshe7M1OQUbYzkI/Hm3c38b/wEmWCSzAl34cgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Not Fast forward example&quot;
        title=&quot;Not Fast forward example&quot;
        src=&quot;/static/9c6cf2a4421b1c7270e317d818f8702c/4bd0f/merge-not-ff.png&quot;
        srcset=&quot;/static/9c6cf2a4421b1c7270e317d818f8702c/0eb09/merge-not-ff.png 500w,
/static/9c6cf2a4421b1c7270e317d818f8702c/4bd0f/merge-not-ff.png 731w&quot;
        sizes=&quot;(max-width: 731px) 100vw, 731px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;위의 상황에서는 fast forward 가 불가능하여 merge 커밋을 생성할 수 밖에 없다.&lt;/p&gt;
&lt;h1&gt;—no-ff 옵션&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 721px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1bf4bb2b7edf2cb98e322b744c41f113/4f939/merge-no-ff.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.8%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAB80lEQVQ4y42U2ZLaMBBF9f9/leUxD1RNJamECR5gEsAQsC0vsrabboE83iDTVSrZlnV6UV8JjMx7HwZbkiRYLpe4XC7hXSnVrUVT2sE63+0VuGP9jdZalGUJ5xzquoYxFt5ZnKXCt98G27+Gd1yBMaII6M9SyhAVQ/iZwVVV0bcWWiucsgo/dha/dlVYYxP9SDowDUdpqLYdrM2lrIkjZYn1ywuyPL+mrLUO6YxTbmo5Sb/vuJ+NMSZEKVqKggenxTPDOTJz+gn35wu8yuBnIICfdSaapglkBjLMkqcA3C3g159g5e620d09uL6zUEOGcsgDswq2OiJND2F93FL3TDysDY00TVEUxfuBk9rw821+5Cz23fhwxCOlbDYbrFarTilz/4zrKR6phOsaB9dx3IdZZXHIDdytdwdKGXvmE48nfz6fA5TbihXDc1FIfH9t8LQ1yErzlvI96bUUjSFY1DJHyIMFENV0Kgw2aUMOM3KipjXsg1vjYKybvSwikA+mIVB6PGK/31+BHP5Uox46f6VWLPA/k9sttHyTqOA6xetJM1wb1KcEWH+A3S/IWYOrPBWiTLkciq4whjWfP0J9fepKEYAcIf/oCMyXpakv8IcFXLamdxccTgb91xZ5gFXJatjY8S4b1tPhvXYgNS2fn0Mn/AOOfdYWTPn4WwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;--no-ff option&quot;
        title=&quot;--no-ff option&quot;
        src=&quot;/static/1bf4bb2b7edf2cb98e322b744c41f113/4f939/merge-no-ff.png&quot;
        srcset=&quot;/static/1bf4bb2b7edf2cb98e322b744c41f113/0eb09/merge-no-ff.png 500w,
/static/1bf4bb2b7edf2cb98e322b744c41f113/4f939/merge-no-ff.png 721w&quot;
        sizes=&quot;(max-width: 721px) 100vw, 721px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--no-ff&lt;/code&gt; 옵션을 사용하면 fast forward 가 가능한 상황에서 merge 커밋을 항상 생성하여 merge 를 진행하게 된다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[정적 웹페이지(Static web)에 환경 변수 사용하기]]></title><description><![CDATA[개요 앱을 작성하고 빌드하다보면 환경 별로 서로 다른 값을 사용해야 하는 값들이 있다.
이러한 설정 값을 환경 변수라고 부른다.
일반적으로 development, staging(qa), production 과 같이 환경을 나누어 사용한다.
그리고 1…]]></description><link>https://cheong38.github.io/2020-09-08-env-static-web/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-09-08-env-static-web/index/</guid><pubDate>Tue, 08 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;앱을 작성하고 빌드하다보면 환경 별로 서로 다른 값을 사용해야 하는 값들이 있다.
이러한 설정 값을 환경 변수라고 부른다.
일반적으로 development, staging(qa), production 과 같이 환경을 나누어 사용한다.
그리고 &lt;a href=&quot;https://12factor.net/ko/config&quot;&gt;12 factors app 에서 가이드&lt;/a&gt;하고 있는 바는 설정 값은 코드에 상수로 저장하기보다는 설정을 코드에서 엄격히 분리하라고 가이드 한다.&lt;/p&gt;
&lt;p&gt;서버 환경에서는 동적으로 환경 변수를 주입해 줄 수 있다.
Nodejs 에서는 일반적으로 NODE_ENV 라는 변수에 development, staging, production 과 같은 값을 넣고,
&lt;a href=&quot;https://www.npmjs.com/package/config&quot;&gt;node-config&lt;/a&gt; 와 같은 라이브러를 사용하여 런타임에 적절한 환경 설정 값을 사용할 수 있게 한다.&lt;/p&gt;
&lt;p&gt;그러나 React, Vue 와 같은 SPA (Single Page Application) 를 작성하면 설정 값의 주입이 정적 시간, 즉 빌드 시간에 이루어지기 때문에 서버 환경에서와 같은 방법을 사용할 수 없다.
이를 해결하기 위한 방법으로 다음과 같은 방법이 있다.&lt;/p&gt;
&lt;p&gt;(본 포스팅에서는 AWS S3 와 같은 정적 호스팅을 이용하지 않고 nginx 환경에서 배포하는 환경에서의 방법을 논한다.)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;환경 별로 서로 다른 빌드를 만든다.&lt;/li&gt;
&lt;li&gt;Nginx 와 같은 웹 서버 실행 시 스크립트를 통해 환경 변수를 넣어준다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;환경 별로 서로 다른 빌드를 만든다.&lt;/h1&gt;
&lt;p&gt;빌드 시에 개발용 환경 변수, QA 용 환경 변수, 상용 환경 변수를 선택하여 빌드하고 배포하는 방식이다.&lt;/p&gt;
&lt;p&gt;개발용으로 빌드할 때에는 아래와 같이 실행하고,&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token assign-left variable&quot;&gt;NODE_ENV&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;development &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;상용으로 빌드할 때에는 아래와 같이 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token assign-left variable&quot;&gt;NODE_ENV&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;production &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그 결과로 나온 빌드 파일을 nginx 와 함께 배포한다.&lt;/p&gt;
&lt;p&gt;단순하고 직관적이지만 환경에 따라 앱 자체가 달라지는 것이 아님에도 불구하고 매번 빌드를 해줘야 한다는 단점이 있다.&lt;/p&gt;
&lt;h1&gt;Nginx 와 같은 웹 서버 실행 시 스크립트를 통해 환경 변수를 넣어준다.&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Docker&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt; 그리고 Nginx 로 구성된 예시를 살펴보자.&lt;/p&gt;
&lt;p&gt;React 에서의 예를 살펴보자.
React 에서는 기본적으로 dotenv 를 사용한다.
&lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;.env.development&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;.env.production&lt;/code&gt; 이 각각 기본값, 개발용, 상용 환경 변수 값을 담고 있다.&lt;/p&gt;
&lt;p&gt;nginx 실행 시, 주입되어 있는 &lt;code class=&quot;language-text&quot;&gt;NODE_ENV&lt;/code&gt; 의 값과 환경 변수에 따라 환경 설정 값을 담은 js 파일을 생성하여
index.html` 에 주입시켜주는 방식이다.&lt;/p&gt;
&lt;h2&gt;dotenv 를 파싱하여 js 파일 만들어주기&lt;/h2&gt;
&lt;p&gt;다음과 같이 &lt;code class=&quot;language-text&quot;&gt;env.sh&lt;/code&gt; 파일을 작성해준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shellscript&quot;&gt;&lt;pre class=&quot;language-shellscript&quot;&gt;&lt;code class=&quot;language-shellscript&quot;&gt;#!/bin/bash

# NOTE: You need to install bash version 4 or above.
# This script makes use of associative arrays.
# https://stackoverflow.com/questions/1494178/how-to-define-hash-tables-in-bash

set -e

declare -A key_values
readonly CURRENT_DIR=$(dirname &amp;quot;$0&amp;quot;)
readonly DIST=&amp;quot;$CURRENT_DIR&amp;quot;/env-config.js

function trim() {
    local var=&amp;quot;$*&amp;quot;
    # remove leading whitespace characters
    var=&amp;quot;${var#&amp;quot;${var%%[![:space:]]*}&amp;quot;}&amp;quot;
    # remove trailing whitespace characters
    var=&amp;quot;${var%&amp;quot;${var##*[![:space:]]}&amp;quot;}&amp;quot;
    printf &amp;#39;%s&amp;#39; &amp;quot;$var&amp;quot;
}

function read_env() {
  local env_filename=$1

  # Read each line in .env file
  # Each line represents key=value pairs
  while read -r line || [[ -n &amp;quot;$line&amp;quot; ]];
  do
    line=$(trim $line)

    # Ignore empty string
    if [ -z &amp;quot;$line&amp;quot; ]; then
      continue
    fi

    # Ignore comments
    first_letter=$(echo $line | head -c 1)
    if [ &amp;quot;$first_letter&amp;quot; = &amp;#39;#&amp;#39; ]; then
      continue
    fi

    # Split env variables by character `=`
    if printf &amp;#39;%s\n&amp;#39; &amp;quot;$line&amp;quot; | grep -q -e &amp;#39;=&amp;#39;; then
      varname=$(printf &amp;#39;%s\n&amp;#39; &amp;quot;$line&amp;quot; | sed -e &amp;#39;s/=.*//&amp;#39;)
      varvalue=$(printf &amp;#39;%s\n&amp;#39; &amp;quot;$line&amp;quot; | sed -e &amp;#39;s/^[^=]*=//&amp;#39;)
    fi

    key_values[$varname]=${varvalue}
  done &amp;lt; &amp;quot;$CURRENT_DIR/$env_filename&amp;quot;
}

function read_env_from_environment_variables() {
  # Read value of current variable if exists as Environment variable
  # If value does not exist as Environment variable, use current value from above.
  for key in &amp;quot;${!key_values[@]}&amp;quot;; do
    value=$(printf &amp;#39;%s\n&amp;#39; &amp;quot;${!key}&amp;quot;)
    # If value
    [[ -z $value ]] &amp;amp;&amp;amp; value=${key_values[$key]}
    key_values[$key]=$value
  done
}

# Recreate config file
rm -f &amp;quot;$DIST&amp;quot;
touch &amp;quot;$DIST&amp;quot;

read_env &amp;quot;.env&amp;quot;
read_env &amp;quot;.env.${NODE_ENV}&amp;quot;
read_env_from_environment_variables

# Add assignment
echo &amp;quot;window._env_ = {&amp;quot; &amp;gt;&amp;gt; &amp;quot;$DIST&amp;quot;

# Append configuration property to JS file
for key in &amp;quot;${!key_values[@]}&amp;quot;; do
  echo &amp;quot;  $key: &amp;#39;${key_values[$key]}&amp;#39;,&amp;quot; &amp;gt;&amp;gt; &amp;quot;$DIST&amp;quot;
done

# Add the closing brace
echo &amp;quot;}&amp;quot; &amp;gt;&amp;gt; &amp;quot;$DIST&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 스크립트는 &lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;.env.{NODE_ENV}&lt;/code&gt; 그리고 shell 에 설정된 환경 변수 값을 읽어서 &lt;code class=&quot;language-text&quot;&gt;env-config.js&lt;/code&gt; 에서 자바스크립트 객체로 만들어준다.&lt;/p&gt;
&lt;h2&gt;&lt;code class=&quot;language-text&quot;&gt;env-config.js&lt;/code&gt; 를 &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt; 에 주입하기&lt;/h2&gt;
&lt;p&gt;React 기본 구조 상에서 &lt;code class=&quot;language-text&quot;&gt;public/index.html&lt;/code&gt; 의 헤더 부분에 다음과 같이 &lt;code class=&quot;language-text&quot;&gt;env-config.js&lt;/code&gt; 를 넣어주는 태그를 추가한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;%PUBLIC_URL%/env-config.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Dockerfile 작성하기&lt;/h2&gt;
&lt;p&gt;Nginx 를 사용하여 배포하는 것은 &lt;a href=&quot;https://dev.to/subhransu/nevertheless-subhransu-maharana-coded-5eam&quot;&gt;다른 포스팅&lt;/a&gt;을 참고하여 작성하고, 추가적으로 &lt;code class=&quot;language-text&quot;&gt;env.sh&lt;/code&gt; 를 Docker 컨테이너에 추가하고, nginx 실행 전에 실행시켜 &lt;code class=&quot;language-text&quot;&gt;env-config.js&lt;/code&gt; 파일이 생성되도록 한다.
그리고 아래의 설정을 Dockerfile 에 추가해준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;COPY ./env.sh .
COPY .env .
COPY .env.development .
COPY .env.production .

RUN apk add &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;no&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cache bash

RUN chmod +x env.sh

CMD &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/usr/share/nginx/html/env.sh &amp;amp;&amp;amp; nginx -g \&quot;daemon off;\&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;실행하기&lt;/h2&gt;
&lt;p&gt;이제 런타임에 환경 설정 값을 변경할 준비가 되었다.&lt;/p&gt;
&lt;p&gt;개발용으로 실행시킬 때는 아래와 같이 실행할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker run -it -p &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:80 -e &lt;span class=&quot;token assign-left variable&quot;&gt;NODE_ENV&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;development &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;DOCKER_IMAGE&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;상용으로 실행시킬 때는 아래와 같이 실행시킬 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker run -it -p &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:80 -e &lt;span class=&quot;token assign-left variable&quot;&gt;NODE_ENV&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;production &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;DOCKER_IMAGE&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;참고&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.freecodecamp.org/news/how-to-implement-runtime-environment-variables-with-create-react-app-docker-and-nginx-7f9d42a91d70/&quot;&gt;https://www.freecodecamp.org/news/how-to-implement-runtime-environment-variables-with-create-react-app-docker-and-nginx-7f9d42a91d70/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Redis 를 메세지 큐 (Message Queue) 로 사용하기 (feat. Bull)]]></title><description><![CDATA[개요 Redis 는 일반적으로 데이터베이스 캐시와 메세지 브로커로 쓰이는 오픈소스로 된 인메모리 데이터 저장소이다.
Redis 에서는 pub/sub 기능도 제공하는데, 여기서 자세한 내용을 찾아볼 수 있다.
Redis pub/sub…]]></description><link>https://cheong38.github.io/2020-08-28-redis-queue/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-08-28-redis-queue/index/</guid><pubDate>Fri, 28 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;개요&lt;/h1&gt;
&lt;p&gt;Redis 는 일반적으로 데이터베이스 캐시와 메세지 브로커로 쓰이는 오픈소스로 된 인메모리 데이터 저장소이다.
Redis 에서는 pub/sub 기능도 제공하는데, &lt;a href=&quot;https://redis.io/topics/pubsub&quot;&gt;여기서&lt;/a&gt; 자세한 내용을 찾아볼 수 있다.
Redis pub/sub 의 주요한 특성 중 하나는 메세지가 구독하는 모든 클라이언트에게 보내진다는 것이다.
즉, 하나의 publish 에 대해서 여러 클라이언트가 실행될 수 있다는 의미이다.
혹은 RPOPLPUSH 등을 이용해 &lt;a href=&quot;https://redis.io/commands/rpoplpush#pattern-reliable-queue&quot;&gt;Reliable Queue 패턴&lt;/a&gt; 을 구현해야 하는데 너무 low-level 디테일을 관여해야 한다.
본 포스팅에서는 &lt;a href=&quot;https://www.npmjs.com/package/bull&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt;&lt;/a&gt; 을 이용해 Redis 를 메세지 큐로 활용하는 법을 설명한다.&lt;/p&gt;
&lt;h1&gt;Bull&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt; 은 Redis 기반의 큐를 제공하는 Nodejs 라이브러리이다.
새 버전인 &lt;a href=&quot;https://github.com/taskforcesh/bullmq&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;BullMQ4&lt;/code&gt;&lt;/a&gt; 개발 진행 중이지만 아직 베타이고 star 수도 그렇게 높지 않아 본 포스팅에서는 &lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt; 로 진행한다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt;은 Redis 의 low-level 디테일을 감추고, Delayed jobs, Retries, Priority, Automatic recovery 등과 같은 기능을 제공함으로써 보다 신뢰도 높고 사용하기 편리하게 만들어준다.&lt;/p&gt;
&lt;h1&gt;실험&lt;/h1&gt;
&lt;p&gt;본 포스팅에서는 두 가지 실험을 진행한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;여러 클라이언트가 대기 중일 때, 오직 하나의 job 만 실행되는가&lt;/li&gt;
&lt;li&gt;클라이언트가 나중에 실행되어도 job 이 실행되는가&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;실험에 사용된 코드는 &lt;a href=&quot;https://github.com/cheong38/nest-bull&quot;&gt;github&lt;/a&gt;에서 확인할 수 있다.&lt;/p&gt;
&lt;h2&gt;사전 준비&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Nodejs v12.x.x&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yarnpkg.com/&quot;&gt;Yarn&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://nestjs.com/&quot;&gt;Nestjs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;디렉토리 구조&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;.
├── consumer/
├── nest-producer/
└── producer/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Consumer&lt;/h2&gt;
&lt;p&gt;먼저 AppModule 에 Redis 설정 값을 넣은 &lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt; 모듈을 import 해준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// consumer/src/app.module.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; BullModule &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/bull&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Module &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/common&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; TestConsumer &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./test.consumer&apos;&lt;/span&gt;

@&lt;span class=&quot;token function&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  imports&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    BullModule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      redis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        host&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        port&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  controllers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  providers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;TestConsumer&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppModule&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 라는 이름의 큐에 메세지가 추가되면 &lt;code class=&quot;language-text&quot;&gt;doJob()&lt;/code&gt; 이라는 메서드가 실행되게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// consumer/src/test.consumer.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Process&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Processor &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/bull&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Job &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bull&apos;&lt;/span&gt;

@&lt;span class=&quot;token function&quot;&gt;Processor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestConsumer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  @&lt;span class=&quot;token function&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doJob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;job&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Job&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;consumer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; job&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Nest Producer&lt;/h2&gt;
&lt;p&gt;먼저 AppModule 에 Redis 설정 값을 넣은 &lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt; 모듈을 import 해준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// nest-producer/src/app.module.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; BullModule &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/bull&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Module &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/common&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AppController &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./app.controller&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

@&lt;span class=&quot;token function&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  imports&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    BullModule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;registerQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      redis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        host&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        port&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  controllers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;AppController&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  providers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppModule&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AppController&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;getHello()&lt;/code&gt; 메서드가 실행되면 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 큐에 &lt;code class=&quot;language-text&quot;&gt;{ data: 1 }&lt;/code&gt; 이라는 데이터와 함께 메세지를 추가한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// nest-producer/src/app.controller.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; InjectQueue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/bull&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Controller&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Get &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;@nestjs/common&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Queue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bull&apos;&lt;/span&gt;

@&lt;span class=&quot;token function&quot;&gt;Controller&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    @&lt;span class=&quot;token function&quot;&gt;InjectQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; testQueue&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Queue
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  @&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getHello&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;testQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;hello&apos;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Producer (without nestjs)&lt;/h2&gt;
&lt;p&gt;Nestjs 없이 &lt;code class=&quot;language-text&quot;&gt;Bull&lt;/code&gt; 라이브러러만을 이용해서 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 큐에 job 을 추가한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// producer/main.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Queue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bull&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; testQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    redis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      host&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      port&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;done&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; testQueue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Redis 실행 (with Docker)&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ docker run --rm -it -p &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;:6379 --name bull-redis redis&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;여러 클라이언트가 대기 중일 때, 오직 하나의 job 만 실행되는가&lt;/h2&gt;
&lt;p&gt;한 터미널에서 아래의 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; consumer
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; start:1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다른 터미널에서 아래의 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; consumer
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; start:2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이제 두 개의 consumer 가 &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; 큐에 메세지가 들어오면 처리할 수 있도록 대기하고 있다.&lt;/p&gt;
&lt;p&gt;다른 터미널에서 아래의 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; producer
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그러면 한 번에 오직 하나의 consumer 에서 log 가 출력되는 것을 확인할 수 있다.
즉, 메세지 하나 당 오직 하나의 클라이언트만 처리를 진행하게 된다.&lt;/p&gt;
&lt;h2&gt;클라이언트가 나중에 실행되어도 job 이 실행되는가&lt;/h2&gt;
&lt;p&gt;한 터미널에서 아래의 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; producer
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 또 다른 터미널에서 아래의 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; consumer
$ &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; start:1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;큐에 메세지가 먼저 들어가게 되고 나중에 그 메세지를 처리하기 위한 클라이언트가 실행된 경우를 시물레이션 하고 있다.
이 경우, consumer 가 실행되자마자 log 가 출력되는 것을 확인할 수 있다.
즉, job processor 가 나중에 실행되어도 처리되지 못한 메세지가 처리될 수 있음을 확인할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Minikube 설치]]></title><description><![CDATA[Minikube minikube 는 설치하면 쿠버네티스 클러스터를 PC 의 가상 머신에서 구동시킬 수 있다. 설치 이 곳 을 참고하여 운영체제에 맞게 설치하면 된다. 구동하기 터미널에 위의 명령어를 입력하면 minikube…]]></description><link>https://cheong38.github.io/2020-08-27-minikube/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-08-27-minikube/index/</guid><pubDate>Thu, 27 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Minikube&lt;/h1&gt;
&lt;p&gt;minikube 는 설치하면 쿠버네티스 클러스터를 PC 의 가상 머신에서 구동시킬 수 있다.&lt;/p&gt;
&lt;h2&gt;설치&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/ko/docs/tasks/tools/install-minikube/&quot;&gt;이 곳&lt;/a&gt; 을 참고하여 운영체제에 맞게 설치하면 된다.&lt;/p&gt;
&lt;h2&gt;구동하기&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ minikube start&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;터미널에 위의 명령어를 입력하면 minikube 환경이 시작된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl config get-contexts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그 후, 위의 명령어를 입력하면,&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;CURRENT   NAME         CLUSTER     AUTHINFO      NAMESPACE
...
*         minikube     minikube    minikube
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같이 minikube 클러스터가 생기고 현재 컨텍스트로 minikube 가 선택되어 있는 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;몇 가지를 더 테스트해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl get namespaces
NAME              STATUS   AGE
default           Active   11m
kube-node-lease   Active   11m
kube-public       Active   11m
kube-system       Active   11m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl get services
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &amp;lt;none&amp;gt;        443/TCP   12m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같이 정상 구동중인 것을 확인할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Istio 서비스 매쉬 (service mesh)]]></title><description><![CDATA[많은 조직에서 마이크로서비스를 채택함에 따라 한 조직 내에도 다양한 배포 환경이 존재하게 되었다.
 는 이러한 배포의 복잡도를 줄이는 것을 도와준다.
 는 오픈 소스 서비스 매쉬(service mesh)이다. 서비스 매쉬 (Service Mesh…]]></description><link>https://cheong38.github.io/2020-08-26-istio-service-mesh/index/</link><guid isPermaLink="false">https://cheong38.github.io/2020-08-26-istio-service-mesh/index/</guid><pubDate>Wed, 26 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;&lt;code class=&quot;language-text&quot;&gt;Istio&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;많은 조직에서 마이크로서비스를 채택함에 따라 한 조직 내에도 다양한 배포 환경이 존재하게 되었다.
&lt;a href=&quot;https://istio.io/latest/&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt;&lt;/a&gt; 는 이러한 배포의 복잡도를 줄이는 것을 도와준다.
&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 는 오픈 소스 서비스 매쉬(service mesh)이다.&lt;/p&gt;
&lt;h2&gt;서비스 매쉬 (Service Mesh)&lt;/h2&gt;
&lt;p&gt;서비스 매쉬(Service Mesh)는 서비스 간 통신의 규모가 커짐에 따라 서비스 간 통신을 추상화하여 안전하고 신뢰할 수 있게 만드는 인프라 계층의 아키텍처이다.
서비스 메쉬(Service Mesh)에서는 서비스의 호출이 서비스에 딸린 프록시(proxy)들끼리 이루어지게 된다.
&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 는 서비스 메쉬 전체에 대한 행위적 인사이트와 운영적인 제어를 제공한다.&lt;/p&gt;
&lt;h3&gt;Istio 서비스 메쉬 (Service Mesh)&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 를 사용하게 되면 각 서비스는 &lt;a href=&quot;https://www.envoyproxy.io/&quot;&gt;envoy proxy&lt;/a&gt; 를 &lt;a href=&quot;https://docs.microsoft.com/ko-kr/azure/architecture/patterns/sidecar&quot;&gt;사이드카 패턴&lt;/a&gt;으로 각 pod 에 주입하게 된다.
&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 는 로드 밸런싱, 서비스 간 인증, 모니터링과 같은 기능을 쉽게 가능하도록 만들어준다.
&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 는 마이크로서비스 간 통신을 모두 가로채 &lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 제어 플레인(plane)을 통해 설정과 제어가 가능토록 해준다.
다음과 같은 기능을 포함한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP, gRPC, 웹소켓, TCP 트래픽에 대한 자동 로드 밸런싱&lt;/li&gt;
&lt;li&gt;라우팅 규칙, 재시도, failover 와 fault injection 과 같은 트래픽 행위의 상세한 설정&lt;/li&gt;
&lt;li&gt;정책 및 API 설정을 pluggable 하게 제공(접근 제어, 속도 및 할당량 제한 등을 지원)&lt;/li&gt;
&lt;li&gt;메트릭, 로그, 트래픽 추적 등을 자동으로 지원&lt;/li&gt;
&lt;li&gt;identity-based 인증으로 클러스터 내 서비스 간 통신을 안전하게 지원&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;/3833ffadadf62b46f3c2cda26a7085d0/istio-mesh.svg&quot; alt=&quot;Istio Architecture&quot;&gt;&lt;/p&gt;
&lt;h3&gt;Istio 설치&lt;/h3&gt;
&lt;p&gt;먼저 실행 환경을 위해 &lt;a href=&quot;/minikube&quot;&gt;minikube 를 설치&lt;/a&gt;하자&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://istio.io/latest/docs/setup/getting-started/&quot;&gt;이 곳&lt;/a&gt;을 참고하여 &lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 를 다운로드하고 &lt;code class=&quot;language-text&quot;&gt;istioctl&lt;/code&gt; 명령어를 등록하자.&lt;/p&gt;
&lt;p&gt;그 후 아래 명령어를 실행하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ istioctl install --set profile=demo
Detected that your cluster does not support third party JWT authentication. Falling back to less secure first party JWT. See https://istio.io/docs/ops/best-practices/security/#configure-third-party-service-account-tokens for details.
✔ Istio core installed
✔ Istiod installed
✔ Ingress gateways installed
✔ Egress gateways installed
✔ Installation complete&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;설치가 완료되었다는 메세지를 받았다.
클러스터에 어떤 변화가 생겼는지 살펴보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl get namespaces
NAME              STATUS   AGE
default           Active   20m
istio-system      Active   50s
kube-node-lease   Active   20m
kube-public       Active   20m
kube-system       Active   20m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;istio-system&lt;/code&gt; 이라는 새로운 namespace 가 생긴 것을 확인할 수 있다.
이 namespace 에는 어떤 서비스들이 있는지 확인해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl get services -n istio-system
NAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                                      AGE
istio-egressgateway    ClusterIP      10.105.158.180   &amp;lt;none&amp;gt;        80/TCP,443/TCP,15443/TCP                                                     46s
istio-ingressgateway   LoadBalancer   10.111.101.97    &amp;lt;pending&amp;gt;     15021:31597/TCP,80:30532/TCP,443:30828/TCP,31400:30090/TCP,15443:31940/TCP   46s
istiod                 ClusterIP      10.105.52.77     &amp;lt;none&amp;gt;        15010/TCP,15012/TCP,443/TCP,15014/TCP,853/TCP                                60s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;egress gateway, ingress gateway, istiod 등의 서비스가 있는 것을 확인할 수 있다.
이들에 대해서는 다음에 다시 자세히 알아보자.
pod 들도 생성되었는지 확인해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kubectl get pods
NAME                                    READY   STATUS    RESTARTS   AGE
istio-egressgateway-695f5944d8-lcwhw    1/1     Running   0          6m41s
istio-ingressgateway-5c697d4cd7-zvb74   1/1     Running   0          6m41s
istiod-59747cbfdd-x7bgg                 1/1     Running   0          6m55s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;서비스 별로 하나의 pod 들이 존재하는 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 가 정상적으로 설치된 것을 확인할 수 있었으면 다음 포스팅에는 실질적인 &lt;code class=&quot;language-text&quot;&gt;istio&lt;/code&gt; 의 사용을 알아보고자 한다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Welcome to WOOJIN]]></title><link>https://cheong38.github.io/welcome/</link><guid isPermaLink="false">https://cheong38.github.io/welcome/</guid><pubDate>Sun, 06 May 2018 23:46:37 GMT</pubDate><content:encoded></content:encoded></item></channel></rss>